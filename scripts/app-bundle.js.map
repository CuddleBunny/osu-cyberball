{"version":3,"sources":["../src/app.ts","../src/app.html","../src/environment.ts","../src/helpers.ts","../src/main.ts","../src/models/banter-model.ts","../src/models/cpu-model.ts","../src/models/player-model.ts","../src/models/settings-model.ts","../src/pages/game.ts","../src/pages/game.html","../src/pages/home.ts","../src/pages/home.html","../src/resources/index.ts","../src/resources/phaser-game/phaser-game.ts"],"names":[],"mappings":"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","file":"app-bundle.js","sourcesContent":["import { RouterConfiguration, Router } from 'aurelia-router';\n\nexport class App {\n    router: Router;\n\n    configureRouter(config: RouterConfiguration, router: Router): void {\n        this.router = router;\n\n        config.title = 'Cyberball';\n\n        config.map([\n            { route: ['', 'home'], name: 'home', moduleId: 'pages/home' },\n            { route: 'game', name: 'game', moduleId: 'pages/game' }\n        ]);\n    }\n}\n","<template>\n    <router-view></router-view>\n</template>\n","export default {\n  debug: true,\n  testing: true\n};\n","export function getCaughtBallPosition(player: Phaser.GameObjects.Sprite) {\n    return { x: player.x + (player.flipX ? -50 : 50), y: player.y - 15 };\n}\n\nexport function getActiveBallPosition(player: Phaser.GameObjects.Sprite) {\n    return { x: player.x + (player.flipX ? 40 : -40), y: player.y - 20 };\n}\n","import {Aurelia} from 'aurelia-framework'\nimport environment from './environment';\n\nexport function configure(aurelia: Aurelia) {\n  aurelia.use\n    .standardConfiguration()\n    .feature('resources');\n\n  aurelia.use.developmentLogging(environment.debug ? 'debug' : 'warn');\n\n  if (environment.testing) {\n    aurelia.use.plugin('aurelia-testing');\n  }\n\n  aurelia.start().then(() => aurelia.setRoot());\n}\n","export class BanterModel {\n    chance: number;\n    delay: number;\n    delayVariance: number;\n    messages: Array<string>;\n}\n","import { BanterModel } from './banter-model';\nimport { PlayerModel } from './player-model';\n\nexport class CPUModel extends PlayerModel {\n    targetPreference: Array<number>;\n\n    throwDelay: number;\n    throwDelayVariance: number;\n\n    catchDelay: number;\n    catchDelayVariance: number;\n\n    introductionBanter: BanterModel;\n    throwBanter: BanterModel\n    catchBanter: BanterModel\n    leftOutBanter: BanterModel\n\n    boredomBanterThreshold: number;\n    boredomBanter: BanterModel;\n}\n","export class PlayerModel {\n    name: string;\n    portrait: string;\n    sprite: string;\n}\n","import { PlayerModel } from './player-model';\nimport { CPUModel } from './cpu-model';\nexport class SettingsModel {\n    player: PlayerModel;\n    computerPlayers: Array<CPUModel>;\n\n    // Gameplay\n    throwCount: number;\n    ballSpeed: number;\n\n    // TODO: schedule\n    // TODO: delay\n\n    // Graphics\n    baseUrl: string;\n    ball: string;\n\n    // Misc\n    chatEnabled: boolean;\n}\n","import Phaser from 'phaser';\nimport { getCaughtBallPosition, getActiveBallPosition } from 'helpers';\n\nconst gameWidth = 800;\nconst gameHeight = 440;\n\nlet playerGroup: Phaser.Physics.Arcade.Group;\n\nlet playerSprite: Phaser.GameObjects.Sprite;\nlet ballSprite: Phaser.GameObjects.Image;\nlet throwTarget: Phaser.GameObjects.Sprite;\n\nlet playerHasBall = true;\nlet ballHeld = true;\n\n// Configuration defaults\n\n// TODO: Get configuration from URL/Aurelia?\n// TODO: Figure out how to configure different positions for 4 players and portraits modes.\nconst playerPosition = new Phaser.Geom.Point(400, 250);\nconst cpuPositions = [\n    new Phaser.Geom.Point(150, 100),\n    new Phaser.Geom.Point(650, 100)\n];\n\nconst config = {\n    cpuCount: 2\n};\n\nfunction preload(this: Phaser.Scene) {\n    // TODO: Load from settings.\n    this.load.image('ball', './assets/ball.png');\n    this.load.multiatlas('player', './assets/player.json', 'assets');\n}\n\nfunction create(this: Phaser.Scene) {\n    this.cameras.main.setBackgroundColor('#ffffff');\n\n    // Player animations\n\n    this.anims.create({\n        key: 'active',\n        frames: this.anims.generateFrameNames('player', { start: 1, end: 1, prefix: 'active/', suffix: '.png' })\n    });\n\n    this.anims.create({\n        key: 'idle',\n        frames: this.anims.generateFrameNames('player', { start: 1, end: 1, prefix: 'idle/', suffix: '.png' })\n    });\n\n    this.anims.create({\n        key: 'throw',\n        frames: this.anims.generateFrameNames('player', { start: 1, end: 3, prefix: 'throw/', suffix: '.png' })\n    });\n\n    this.anims.create({\n        key: 'catch',\n        frames: this.anims.generateFrameNames('player', { start: 1, end: 1, prefix: 'catch/', suffix: '.png' }),\n        frameRate: 4\n    });\n\n    // Set up player\n    playerGroup = this.physics.add.group({ immovable: true });\n    playerSprite = playerGroup.create(playerPosition.x, playerPosition.y, 'player', 'active/1.png');\n\n    // Set up CPU\n    for(let i = 0; i < config.cpuCount; i++) {\n        let cpuSprite = playerGroup.create(cpuPositions[i].x, cpuPositions[i].y, 'player', 'idle/1.png');\n\n        cpuSprite.flipX = cpuPositions[i].x > playerPosition.x;\n\n        cpuSprite.setInteractive();\n        cpuSprite.on('pointerdown', (e) => {\n            if(playerHasBall) {\n                playerHasBall = ballHeld = false;\n                throwTarget = cpuSprite;\n\n                playerSprite.play('throw');\n\n                playerSprite.anims.currentAnim.once('complete', () => { playerSprite.play('idle') });\n\n                let ballTargetPosition = getCaughtBallPosition(cpuSprite);\n                this.physics.moveTo(ballSprite, ballTargetPosition.x, ballTargetPosition.y, 500);\n            }\n        });\n    }\n\n    // Set up ball\n    let ballPosition = getActiveBallPosition(playerSprite);\n    ballSprite = this.physics.add.image(ballPosition.x, ballPosition.y, 'ball');\n\n    console.log(playerGroup);\n\n    this.physics.add.overlap(ballSprite, playerGroup, (ball, player: Phaser.GameObjects.Sprite) => {\n        if(!ballHeld && player === throwTarget) {\n            ballHeld = true;\n\n            if(player === playerSprite) {\n                playerHasBall = true;\n            }\n\n            player.play('catch');\n\n            let ballPosition = getCaughtBallPosition(player);\n            (ball.body as Phaser.Physics.Arcade.Body).reset(ballPosition.x, ballPosition.y);\n        }\n    });\n\n    // TODO: Use events to talk to Qualtrics?\n    //setTimeout(() => { window.dispatchEvent(new CustomEvent('complete', { detail: { test: 'test' } }))}, 1000)\n}\n\nfunction update(this: Phaser.Scene) {\n    if (playerHasBall) {\n        // If the player has the ball:\n        //  - Player character looks in the direction of the mouse\n        //  - Player can click a CPU to throw the ball.\n        playerSprite.play('active');\n        playerSprite.flipX = this.input.x < gameWidth / 2;\n\n        let ballPosition = getActiveBallPosition(playerSprite);\n        ballSprite.x = ballPosition.x;\n        ballSprite.y = ballPosition.y;\n    }\n}\n\nexport class GameViewModel {\n    gameConfig: Phaser.Types.Core.GameConfig = {\n        type: Phaser.AUTO,\n        width: gameWidth,\n        height: gameHeight,\n        scene: {\n            preload: preload,\n            create: create,\n            update: update\n        },\n        physics: {\n            default: 'arcade',\n            arcade: {\n                debug: true\n            }\n        }\n    }\n}\n","<template>\n    <h1>Cyberball</h1>\n\n    <phaser-game config.bind=\"gameConfig\"></phaser-game>\n</template>\n","export class HomeViewModel {\n\n}\n","<template>\n    <h1>Welcome to Cyberball</h1>\n</template>\n","import { FrameworkConfiguration, PLATFORM } from 'aurelia-framework';\n\nexport function configure(config: FrameworkConfiguration) {\n    config.globalResources(PLATFORM.moduleName('./phaser-game/phaser-game'));\n}\n","import { customElement, bindable, autoinject, inlineView } from \"aurelia-framework\";\nimport Phaser from 'phaser';\n\n@customElement('phaser-game')\n@autoinject()\n@inlineView('<template></template>')\nexport class PhaserGameCustomElement {\n    @bindable config: Phaser.Types.Core.GameConfig;\n    @bindable game: Phaser.Game;\n\n    constructor(protected element: Element) {\n\n    }\n\n    bind() {\n        this.config.parent = this.element as HTMLElement;\n        this.game = new Phaser.Game(this.config);\n    }\n}\n"]}