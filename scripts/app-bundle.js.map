{"version":3,"sources":["../src/app.ts","../src/app.html","../src/behaviors/get-variant-value.ts","../src/enums/leave-trigger.ts","../src/environment.ts","../src/helpers.ts","../src/main.ts","../src/models/banter-model.ts","../src/models/cpu-model.ts","../src/models/cpu-settings-model.ts","../src/models/player-model.ts","../src/models/player-settings-model.ts","../src/models/settings-model.ts","../src/pages/game.ts","../src/pages/game.css","../src/pages/game.html","../src/pages/home.ts","../src/pages/home.html","../src/pages/message-test.ts","../src/pages/message-test.html","../src/resources/index.ts","../src/resources/phaser-game/phaser-game.ts","../src/resources/value-converters/flag-value-converter.ts","../src/resources/value-converters/integer-array-value-converter.ts","../src/resources/value-converters/integer-value-converter.ts","../src/resources/value-converters/json-value-converter.ts","../src/resources/value-converters/number-value-converter.ts","../src/scenes/cyberball.ts"],"names":[],"mappings":";;;;IAEA;QAAA;QAcA,CAAC;QAXG,6BAAe,GAAf,UAAgB,MAA2B,EAAE,MAAc;YACvD,IAAI,CAAC,MAAM,GAAG,MAAM,CAAC;YAErB,MAAM,CAAC,KAAK,GAAG,WAAW,CAAC;YAE3B,MAAM,CAAC,GAAG,CAAC;gBACP,EAAE,KAAK,EAAE,CAAC,EAAE,EAAE,MAAM,CAAC,EAAE,IAAI,EAAE,MAAM,EAAE,QAAQ,EAAE,YAAY,EAAE;gBAC7D,EAAE,KAAK,EAAE,MAAM,EAAE,IAAI,EAAE,MAAM,EAAE,QAAQ,EAAE,YAAY,EAAE;gBACvD,EAAE,KAAK,EAAE,cAAc,EAAE,IAAI,EAAE,cAAc,EAAE,QAAQ,EAAE,oBAAoB,EAAE;aAClF,CAAC,CAAC;QACP,CAAC;QACL,UAAC;IAAD,CAdA,AAcC,IAAA;IAdY,kBAAG;;;ACFhB;;;;;ICAA,SAAgB,eAAe,CAAC,IAAY,EAAE,QAAgB;QAC1D,OAAO,IAAI,GAAG,CAAC,MAAM,CAAC,IAAI,CAAC,GAAG,CAAC,OAAO,CAAC,CAAC,EAAE,QAAQ,CAAC,GAAG,MAAM,CAAC,IAAI,CAAC,GAAG,CAAC,IAAI,EAAE,CAAC,CAAC;IAClF,CAAC;IAFD,0CAEC;;;;;;;ICFD,IAAY,YAOX;IAPD,WAAY,YAAY;QACpB,+CAAQ,CAAA;QACR,+CAAQ,CAAA;QACR,+CAAa,CAAA;QACb,qDAAgB,CAAA;QAChB,6DAAoB,CAAA;QACpB,8DAAoB,CAAA;IACxB,CAAC,EAPW,YAAY,GAAZ,oBAAY,KAAZ,oBAAY,QAOvB;;;;;;ICPD,kBAAe;QACb,KAAK,EAAE,IAAI;QACX,OAAO,EAAE,IAAI;KACd,CAAC;;;;;;;ICHF,SAAgB,qBAAqB,CAAC,MAAiC;QACnE,OAAO,EAAE,CAAC,EAAE,MAAM,CAAC,CAAC,GAAG,CAAC,MAAM,CAAC,KAAK,CAAC,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,MAAM,CAAC,CAAC,GAAG,EAAE,EAAE,CAAC;IACzE,CAAC;IAFD,sDAEC;IAED,SAAgB,qBAAqB,CAAC,MAAiC;QACnE,OAAO,EAAE,CAAC,EAAE,MAAM,CAAC,CAAC,GAAG,CAAC,MAAM,CAAC,KAAK,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,MAAM,CAAC,CAAC,GAAG,EAAE,EAAE,CAAC;IACzE,CAAC;IAFD,sDAEC;;;;;;;;;;;ICHD,SAAgB,SAAS,CAAC,OAAgB;QACxC,OAAO,CAAC,GAAG;aACR,qBAAqB,EAAE;aACvB,OAAO,CAAC,WAAW,CAAC,CAAC;QAExB,OAAO,CAAC,GAAG,CAAC,kBAAkB,CAAC,qBAAW,CAAC,KAAK,CAAC,CAAC,CAAC,OAAO,CAAC,CAAC,CAAC,MAAM,CAAC,CAAC;QAErE,IAAI,qBAAW,CAAC,OAAO,EAAE;YACvB,OAAO,CAAC,GAAG,CAAC,MAAM,CAAC,iBAAiB,CAAC,CAAC;SACvC;QAED,OAAO,CAAC,KAAK,EAAE,CAAC,IAAI,CAAC,cAAM,OAAA,OAAO,CAAC,OAAO,EAAE,EAAjB,CAAiB,CAAC,CAAC;IAChD,CAAC;IAZD,8BAYC;;;;;;;ICfD;QAAA;QAKA,CAAC;QAAD,kBAAC;IAAD,CALA,AAKC,IAAA;IALY,kCAAW;;;;;;;;;;;;;;;;;;;;;;ICKxB;QAAyB,uBAAM;QAG3B,aAAY,QAA0B,EAAE,aAA6B;mBACjE,kBAAM,QAAQ,EAAE,aAAa,CAAC;QAClC,CAAC;QACL,UAAC;IAAD,CANA,AAMC,CANwB,qBAAM,GAM9B;IANY,kBAAG;;;;;;;;;;;;;;;;;;;;;;ICFhB;QAAsC,oCAAmB;QAwBrD,0BAAY,IAAgC;YAA5C,YACI,iBAAO,SAIV;YA3BD,sBAAgB,GAAkB,CAAC,EAAE,EAAE,EAAE,CAAC,CAAC;YAE3C,gBAAU,GAAW,GAAG,CAAC;YACzB,wBAAkB,GAAW,GAAG,CAAC;YAEjC,gBAAU,GAAW,GAAG,CAAC;YACzB,wBAAkB,GAAW,GAAG,CAAC;YAUjC,qBAAe,GAAY,GAAG,CAAC;YAC/B,qBAAe,GAAY,GAAG,CAAC;YAC/B,wBAAkB,GAAY,GAAG,CAAC;YAClC,4BAAsB,GAAY,GAAG,CAAC;YACtC,4BAAsB,GAAY,EAAE,CAAC;YAKjC,IAAG,IAAI;gBACH,MAAM,CAAC,MAAM,CAAC,KAAI,EAAE,IAAI,CAAC,CAAC;;QAClC,CAAC;QACL,uBAAC;IAAD,CA9BA,AA8BC,CA9BqC,2CAAmB,GA8BxD;IA9BY,4CAAgB;;;;;;;ICG7B;QAeI,gBAAY,QAA6B,EAAE,aAA6B;YAVjE,YAAO,GAAY,KAAK,CAAC;YAW5B,IAAI,CAAC,QAAQ,GAAG,QAAQ,CAAC;YACzB,IAAI,CAAC,aAAa,GAAG,aAAa,CAAC;QACvC,CAAC;QAEM,uBAAM,GAAb;YAGI,IAAI,QAAQ,GAAG,IAAI,CAAC,WAAW,EAAE,CAAC;YAElC,IAAI,CAAC,KAAK,GAAG,IAAI,CAAC,aAAa,CAAC,OAAO,CAAC,GAAG,CAAC,KAAK,CAAC,EAAE,SAAS,EAAE,IAAI,EAAE,YAAY,EAAE,KAAK,EAAE,CAAC,CAAC;YAG5F,IAAI,CAAC,MAAM,GAAG,IAAI,CAAC,KAAK,CAAC,MAAM,CAAC,QAAQ,CAAC,CAAC,EAAE,QAAQ,CAAC,CAAC,EAAE,QAAQ,EAAE,cAAc,CAAC,CAAC;YAElF,IAAI,IAAI,CAAC,QAAQ,CAAC,IAAI;gBAClB,IAAI,CAAC,MAAM,CAAC,OAAO,CAAC,QAAQ,CAAC,IAAI,CAAC,QAAQ,CAAC,IAAI,CAAC,SAAS,CAAC,CAAC,CAAC,EAAE,EAAE,CAAC,CAAC,CAAC;YAEvE,IAAI,CAAC,QAAQ,GAAG,IAAI,CAAC,aAAa,CAAC,GAAG,CAAC,IAAI,CACvC,QAAQ,CAAC,CAAC,EACV,QAAQ,CAAC,CAAC,GAAG,IAAI,CAAC,MAAM,CAAC,MAAM,GAAG,CAAC,GAAG,EAAE,EACxC,IAAI,CAAC,QAAQ,CAAC,IAAI,EAClB,EAAE,UAAU,EAAE,OAAO,EAAE,KAAK,EAAE,SAAS,EAAE,CAC5C,CAAC,SAAS,CAAC,GAAG,CAAC,CAAC;YAEjB,IAAI,IAAI,CAAC,QAAQ,CAAC,QAAQ,EAAE;gBACxB,IAAI,gBAAgB,GAAG,IAAI,CAAC,mBAAmB,EAAE,CAAC;gBAElD,IAAI,CAAC,QAAQ,GAAG,IAAI,CAAC,aAAa,CAAC,GAAG,CAAC,KAAK,CAAC,gBAAgB,CAAC,CAAC,EAAE,gBAAgB,CAAC,CAAC,EAAE,gBAAgB,CAAC,CAAC;aAC1G;YAID,IAAI,CAAC,IAAI,CAAC,QAAQ,CAAC,YAAY,GAAG,4BAAY,CAAC,IAAI,CAAC,KAAK,4BAAY,CAAC,IAAI,EAAE;gBACxE,IAAI,CAAC,kBAAkB,GAAG,IAAI,CAAC,GAAG,EAAE,GAAG,IAAA,mCAAe,EAAC,IAAI,CAAC,QAAQ,CAAC,SAAS,EAAE,IAAI,CAAC,QAAQ,CAAC,iBAAiB,CAAC,GAAG,IAAI,CAAC;aAC3H;YAED,IAAI,CAAC,IAAI,CAAC,QAAQ,CAAC,YAAY,GAAG,4BAAY,CAAC,WAAW,CAAC,KAAK,4BAAY,CAAC,WAAW,EAAE;gBACtF,IAAI,CAAC,wBAAwB,GAAG,IAAI,CAAC,GAAG,EAAE,GAAG,IAAA,mCAAe,EAAC,IAAI,CAAC,QAAQ,CAAC,gBAAgB,EAAE,IAAI,CAAC,QAAQ,CAAC,wBAAwB,CAAC,GAAG,IAAI,CAAC;aAC/I;QACL,CAAC;QAGS,4BAAW,GAArB;YACI,IAAI,OAAO,GAAG,EAAE,CAAC;YAEjB,IAAG,IAAI,CAAC,aAAa,CAAC,QAAQ,CAAC,YAAY;gBACvC,OAAO,IAAI,IAAI,CAAC,aAAa,CAAC,QAAQ,CAAC,cAAc,GAAG,IAAI,CAAC,aAAa,CAAC,QAAQ,CAAC,eAAe,GAAG,CAAC,CAAC;YAE5G,OAAO,IAAI,MAAM,CAAC,IAAI,CAAC,KAAK,CACxB,IAAI,CAAC,aAAa,CAAC,GAAG,CAAC,MAAM,CAAC,KAAK,GAAG,CAAC,EACvC,IAAI,CAAC,aAAa,CAAC,GAAG,CAAC,MAAM,CAAC,MAAM,GAAG,OAAO,CACjD,CAAC;QACN,CAAC;QAES,oCAAmB,GAA7B;YACI,IAAI,QAAQ,GAAG,IAAI,CAAC,WAAW,EAAE,CAAC;YAElC,OAAO,IAAI,MAAM,CAAC,IAAI,CAAC,KAAK,CACxB,QAAQ,CAAC,CAAC,EACV,QAAQ,CAAC,CAAC,GAAG,IAAI,CAAC,aAAa,CAAC,QAAQ,CAAC,cAAc,GAAG,CAAC,GAAG,IAAI,CAAC,aAAa,CAAC,QAAQ,CAAC,eAAe,GAAG,CAAC,GAAG,IAAI,CAAC,MAAM,CAAC,MAAM,GAAG,CAAC,GAAG,EAAE,CAC9I,CAAC;QACN,CAAC;QACL,aAAC;IAAD,CA9EA,AA8EC,IAAA;IA9EY,wBAAM;;;;;;;ICJnB;QA4BI,6BAAY,IAAmC;YArB/C,iBAAY,GAAkB,4BAAY,CAAC,IAAI,CAAC;YAGhD,cAAS,GAAY,EAAE,CAAC;YACxB,sBAAiB,GAAY,CAAC,CAAC;YAG/B,cAAS,GAAY,GAAG,CAAC;YACzB,sBAAiB,GAAY,EAAE,CAAC;YAGhC,iBAAY,GAAY,EAAE,CAAC;YAC3B,yBAAoB,GAAY,CAAC,CAAC;YAGlC,qBAAgB,GAAY,EAAE,CAAC;YAC/B,6BAAwB,GAAY,EAAE,CAAC;YAGvC,qBAAgB,GAAY,CAAC,CAAC;YAG1B,IAAG,IAAI;gBACH,MAAM,CAAC,MAAM,CAAC,IAAI,EAAE,IAAI,CAAC,CAAC;QAClC,CAAC;QACL,0BAAC;IAAD,CAhCA,AAgCC,IAAA;IAhCY,kDAAmB;;;;;;;ICChC;QAoCI,uBAAY,IAA6B;YAnCzC,WAAM,GAAwB,IAAI,2CAAmB,EAAE,CAAC;YAIxD,eAAU,GAAW,EAAE,CAAC;YACxB,cAAS,GAAW,CAAC,CAAC;YACtB,qBAAgB,GAAY,KAAK,CAAC;YAClC,kBAAa,GAAW,aAAa,CAAC;YACtC,cAAS,GAAW,GAAG,CAAC;YAExB,gBAAW,GAAY,KAAK,CAAC;YAC7B,6BAAwB,GAAY,KAAK,CAAC;YAC1C,aAAQ,GAAkB;gBACtB,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC;aACrC,CAAC;YAGF,YAAO,GAAW,UAAU,CAAC;YAE7B,eAAU,GAAW,UAAU,CAAC;YAGhC,mBAAc,GAAW,EAAE,CAAC;YAC5B,oBAAe,GAAW,EAAE,CAAC;YAO7B,gBAAW,GAAY,KAAK,CAAC;YAE7B,iBAAY,GAAW,WAAW,CAAC;YACnC,oBAAe,GAAW,GAAG,CAAC;YAG1B,MAAM,CAAC,MAAM,CAAC,IAAI,EAAE,IAAI,CAAC,CAAC;QAC9B,CAAC;QAZD,sBAAI,uCAAY;iBAAhB;gBACI,OAAO,IAAI,CAAC,MAAM,CAAC,QAAQ,IAAI,IAAI,CAAC,eAAe,CAAC,IAAI,CAAC,UAAA,GAAG,IAAI,OAAA,GAAG,CAAC,QAAQ,EAAZ,CAAY,CAAC,CAAC;YAClF,CAAC;;;WAAA;QAWL,oBAAC;IAAD,CAvCA,AAuCC,IAAA;IAvCY,sCAAa;IAyCb,QAAA,eAAe,GAAG,IAAI,aAAa,CAAC;QAC7C,MAAM,EAAE,IAAI,2CAAmB,CAAC;YAC7B,IAAI,EAAE,UAAU;SAClB,CAAC;QACF,eAAe,EAAE;YACb,IAAI,qCAAgB,CAAC;gBACjB,IAAI,EAAE,UAAU;aACnB,CAAC;YACF,IAAI,qCAAgB,CAAC;gBACjB,IAAI,EAAE,UAAU;aACnB,CAAC;SACL;KACJ,CAAC,CAAC;;;;;;;;;;;IC/CH;QAAA;YACI,aAAQ,GAAkB,gCAAe,CAAC;YAM1C,cAAS,GAAG,GAAG,CAAC;YAChB,eAAU,GAAG,GAAG,CAAC;YAiCjB,iBAAY,GAA0C,EAAE,CAAC;QAU7D,CAAC;QAvCG,gCAAQ,GAAR,UAAS,MAAM;YACX,IAAG,UAAU,IAAI,MAAM,EAAE;gBACrB,IAAI,CAAC,QAAQ,GAAG,IAAI,8BAAa,CAAC,IAAI,CAAC,KAAK,CAAC,IAAI,CAAC,MAAM,CAAC,QAAQ,CAAC,CAAC,CAAC,CAAC;aACxE;YAED,IAAG,YAAY,IAAI,MAAM,EAAE;gBACvB,IAAI,CAAC,QAAQ,CAAC,MAAM,CAAC,IAAI,GAAG,MAAM,CAAC,UAAU,CAAC;aACjD;YAED,IAAG,IAAI,CAAC,QAAQ,CAAC,YAAY,EAAE;gBAC3B,IAAI,CAAC,UAAU,IAAI,IAAI,CAAC,QAAQ,CAAC,cAAc,GAAG,CAAC,GAAG,IAAI,CAAC,QAAQ,CAAC,eAAe,GAAG,CAAC,CAAC;aAC3F;QACL,CAAC;QAED,4BAAI,GAAJ;YACI,IAAI,CAAC,UAAU,GAAI;gBACf,IAAI,EAAE,gBAAM,CAAC,IAAI;gBACjB,KAAK,EAAE,IAAI,CAAC,SAAS;gBACrB,MAAM,EAAE,IAAI,CAAC,UAAU;gBACvB,KAAK,EAAE,IAAI,0BAAc,CAAC,IAAI,CAAC,QAAQ,CAAC;gBACxC,OAAO,EAAE;oBACL,OAAO,EAAE,QAAQ;iBACpB;aACJ,CAAC;QACN,CAAC;QAOD,mCAAW,GAAX;YACI,IAAI,CAAC,YAAY,CAAC,IAAI,CAAC;gBACnB,MAAM,EAAE,IAAI,CAAC,QAAQ,CAAC,MAAM,CAAC,IAAI;gBACjC,IAAI,EAAE,IAAI,CAAC,WAAW;aACzB,CAAC,CAAC;YAEH,IAAI,CAAC,WAAW,GAAG,EAAE,CAAC;QAC1B,CAAC;QACL,oBAAC;IAAD,CAnDA,AAmDC,IAAA;IAnDY,sCAAa;;;ACT1B;ACAA;;;;;;;;;;;;;;;;;;ICOA;QAII,uBAAoB,QAAyB;YAAzB,aAAQ,GAAR,QAAQ,CAAiB;YAH7C,aAAQ,GAAkB,gCAAe,CAAC;QAGM,CAAC;QAEjD,4BAAI,GAAJ;YACI,IAAI,CAAC,SAAS,GAAG,IAAI,mBAAW,CAAC,OAAO,CAAC,CAAC;QAC9C,CAAC;QAED,8BAAM,GAAN;YACI,IAAI,CAAC,SAAS,CAAC,OAAO,EAAE,CAAC;QAC7B,CAAC;QAED,8BAAM,GAAN;YAAA,iBASC;YARG,IAAI,CAAC,QAAQ,CAAC,eAAe,CAAC,IAAI,CAAC,IAAI,qCAAgB,CAAC;gBACpD,IAAI,EAAE,iBAAU,IAAI,CAAC,QAAQ,CAAC,eAAe,CAAC,MAAM,GAAG,CAAC,CAAE;aAC7D,CAAC,CAAC,CAAC;YAEJ,IAAI,CAAC,QAAQ,CAAC,eAAe,CAAC,OAAO,CAAC,UAAA,GAAG;gBACrC,OAAM,GAAG,CAAC,gBAAgB,CAAC,MAAM,IAAI,KAAI,CAAC,QAAQ,CAAC,eAAe,CAAC,MAAM;oBACrE,GAAG,CAAC,gBAAgB,CAAC,IAAI,CAAC,CAAC,CAAC,CAAC;YACrC,CAAC,CAAC,CAAC;QACP,CAAC;QAED,iCAAS,GAAT;YACI,IAAI,CAAC,QAAQ,CAAC,eAAe,CAAC,GAAG,EAAE,CAAC;YAEpC,IAAI,CAAC,QAAQ,CAAC,eAAe,CAAC,OAAO,CAAC,UAAA,GAAG;gBACrC,GAAG,CAAC,gBAAgB,CAAC,GAAG,EAAE,CAAC;YAC/B,CAAC,CAAC,CAAC;QACP,CAAC;QAED,oCAAY,GAAZ;YACI,IAAI,CAAC,QAAQ,CAAC,MAAM,CAAC,eAAe,CAAC,CAAC;QAC1C,CAAC;QAED,sBAAI,8BAAG;iBAAP;gBACI,IAAI,GAAG,GAAG,QAAQ,CAAC,QAAQ,CAAC,MAAM,GAAG,QAAQ,CAAC,QAAQ,CAAC,QAAQ,CAAC;gBAEhE,GAAG,IAAI,iBAAiB,CAAC;gBACzB,GAAG,IAAI,IAAI,CAAC,IAAI,CAAC,SAAS,CAAC,IAAI,CAAC,QAAQ,CAAC,CAAC,CAAC;gBAE3C,OAAO,GAAG,CAAC;YACf,CAAC;;;WAAA;QAED,gCAAQ,GAAR;YACI,MAAM,CAAC,IAAI,CAAC,IAAI,CAAC,GAAG,CAAC,CAAC;QAC1B,CAAC;QAhDQ,aAAa;YADzB,IAAA,8BAAU,GAAE;6CAKqB,8CAAe;WAJpC,aAAa,CAiDzB;QAAD,oBAAC;KAlDD,AAkDC,IAAA;;;ACxDD;;;;;;;;;;;;;;ICIA;QAGI,8BAAoB,QAAyB;YAAzB,aAAQ,GAAR,QAAQ,CAAiB;YAF7C,aAAQ,GAAe,EAAE,CAAC;QAEsB,CAAC;QAEjD,mCAAI,GAAJ;YAAA,iBAOC;YANG,MAAM,CAAC,gBAAgB,CAAC,SAAS,EAAE,UAAC,CAAC;gBACjC,OAAO,CAAC,GAAG,CAAC,SAAS,EAAE,CAAC,CAAC,IAAI,CAAC,CAAC;gBAC/B,KAAI,CAAC,QAAQ,CAAC,IAAI,CAAC,CAAC,CAAC,IAAI,CAAC,CAAC;gBAE3B,KAAI,CAAC,QAAQ,CAAC,MAAM,CAAC,SAAS,CAAC,CAAC;YACpC,CAAC,CAAC,CAAC;QACP,CAAC;QAZQ,oBAAoB;YADhC,IAAA,8BAAU,GAAE;6CAIqB,8CAAe;WAHpC,oBAAoB,CAahC;QAAD,2BAAC;KAdD,AAcC,IAAA;;;ACjBD;;;;;ICEA,SAAgB,SAAS,CAAC,MAA8B;QACpD,MAAM,CAAC,eAAe,CAAC,4BAAQ,CAAC,UAAU,CAAC,2BAA2B,CAAC,CAAC,CAAC;IAC7E,CAAC;IAFD,8BAEC;;;;;;;;;;;;;;;;;;;;ICED;QAII,iCAAsB,OAAgB;YAAhB,YAAO,GAAP,OAAO,CAAS;QAEtC,CAAC;QAED,sCAAI,GAAJ;YACI,IAAI,CAAC,MAAM,CAAC,MAAM,GAAG,IAAI,CAAC,OAAsB,CAAC;YACjD,IAAI,CAAC,IAAI,GAAG,IAAI,gBAAM,CAAC,IAAI,CAAC,IAAI,CAAC,MAAM,CAAC,CAAC;QAC7C,CAAC;QAVS;YAAT,4BAAQ;;+DAAsC;QACrC;YAAT,4BAAQ;sCAAO,gBAAM,CAAC,IAAI;6DAAC;QAFnB,uBAAuB;YAHnC,IAAA,iCAAa,EAAC,aAAa,CAAC;YAC5B,IAAA,8BAAU,GAAE;YACZ,IAAA,8BAAU,EAAC,uBAAuB,CAAC;6CAKD,OAAO;WAJ7B,uBAAuB,CAYnC;QAAD,8BAAC;KAfD,AAeC,IAAA;;;;;;;IClBD;QAAA;QAQA,CAAC;QAPG,qCAAQ,GAAR,UAAS,KAAK,EAAE,MAAM,EAAE,IAAI;YACxB,OAAO,KAAK,CAAC,CAAC,CAAC,MAAM,GAAG,IAAI,CAAC,CAAC,CAAC,MAAM,GAAG,CAAC,IAAI,CAAC;QAClD,CAAC;QAED,mCAAM,GAAN,UAAO,MAAM,EAAE,MAAM,EAAE,IAAI;YACvB,OAAO,CAAC,MAAM,GAAG,IAAI,CAAC,KAAK,IAAI,CAAC;QACpC,CAAC;QACL,yBAAC;IAAD,CARA,AAQC,IAAA;IARY,gDAAkB;;;;;;;ICA/B;QAAA;QAeA,CAAC;QAdG,6CAAQ,GAAR,UAAS,KAAa;YAElB,KAAK,GAAG,KAAK,CAAC,OAAO,CAAC,UAAU,EAAE,EAAE,CAAC,CAAC;YAGtC,IAAG,KAAK,CAAC,KAAK,CAAC,MAAM,GAAG,CAAC,CAAC,IAAI,GAAG;gBAC7B,KAAK,GAAG,KAAK,CAAC,MAAM,CAAC,CAAC,EAAE,KAAK,CAAC,MAAM,GAAG,CAAC,CAAC,CAAC;YAE9C,OAAO,IAAI,CAAC,KAAK,CAAC,WAAI,KAAK,MAAG,CAAC,CAAC;QACpC,CAAC;QAED,2CAAM,GAAN,UAAO,KAAoB;YACvB,OAAO,IAAI,CAAC,SAAS,CAAC,KAAK,CAAC,CAAC,MAAM,CAAC,CAAC,EAAE,KAAK,CAAC,MAAM,GAAG,CAAC,GAAG,CAAC,CAAC,CAAC;QACjE,CAAC;QACL,iCAAC;IAAD,CAfA,AAeC,IAAA;IAfY,gEAA0B;;;;;;;ICAvC;QAAA;QAIA,CAAC;QAHG,wCAAQ,GAAR,UAAS,KAAK;YACV,OAAO,QAAQ,CAAC,KAAK,aAAL,KAAK,cAAL,KAAK,GAAI,GAAG,CAAC,CAAC;QAClC,CAAC;QACL,4BAAC;IAAD,CAJA,AAIC,IAAA;IAJY,sDAAqB;;;;;;;ICAlC;QAAA;QAIA,CAAC;QAHG,mCAAM,GAAN,UAAO,KAAK;YACR,OAAO,IAAI,CAAC,SAAS,CAAC,KAAK,EAAE,IAAI,EAAE,CAAC,CAAC,CAAC;QAC1C,CAAC;QACL,yBAAC;IAAD,CAJA,AAIC,IAAA;IAJY,gDAAkB;;;;;;;ICA/B;QAAA;QAIA,CAAC;QAHG,uCAAQ,GAAR,UAAS,KAAK;YACV,OAAO,UAAU,CAAC,KAAK,aAAL,KAAK,cAAL,KAAK,GAAI,GAAG,CAAC,CAAC;QACpC,CAAC;QACL,2BAAC;IAAD,CAJA,AAIC,IAAA;IAJY,oDAAoB;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;ICMjC,IAAM,SAAS,GAAG,EAAE,UAAU,EAAE,OAAO,EAAE,KAAK,EAAE,SAAS,EAAE,CAAC;IAG5D;QAAoC,kCAAY;QAgC5C,wBAAY,QAAuB;YAAnC,YACI,kBAAM,EAAE,CAAC,SAGZ;YA3BO,gBAAU,GAAgC,EAAE,CAAC;YAK7C,mBAAa,GAAG,IAAI,CAAC;YACrB,cAAQ,GAAG,IAAI,CAAC;YAKhB,mBAAa,GAAa,EAAE,CAAC;YAC7B,qBAAe,GAAY,KAAK,CAAC;YAEjC,eAAS,GAAG,KAAK,CAAC;YAIlB,gBAAU,GAAG,CAAC,CAAC;YACf,mBAAa,GAAG,CAAC,CAAC;YAOtB,KAAI,CAAC,QAAQ,GAAG,QAAQ,CAAC;;QAC7B,CAAC;QAEM,gCAAO,GAAd;YAAA,iBAcC;YAbG,IAAI,CAAC,IAAI,CAAC,WAAW,GAAG,WAAW,CAAC;YAGpC,IAAI,CAAC,IAAI,CAAC,KAAK,CAAC,MAAM,EAAE,UAAG,IAAI,CAAC,QAAQ,CAAC,OAAO,cAAI,IAAI,CAAC,QAAQ,CAAC,UAAU,CAAE,CAAC,CAAC;YAChF,IAAI,CAAC,IAAI,CAAC,UAAU,CAAC,QAAQ,EAAE,UAAG,IAAI,CAAC,QAAQ,CAAC,OAAO,iBAAc,EAAE,QAAQ,CAAC,CAAC;YAEjF,IAAG,IAAI,CAAC,QAAQ,CAAC,MAAM,CAAC,QAAQ;gBAC5B,IAAI,CAAC,IAAI,CAAC,KAAK,CAAC,gBAAgB,EAAE,wBAAwB,GAAG,IAAI,CAAC,QAAQ,CAAC,MAAM,CAAC,QAAQ,CAAC,CAAC;YAEhG,IAAI,CAAC,QAAQ,CAAC,eAAe,CAAC,OAAO,CAAC,UAAC,GAAG,EAAE,CAAC;gBACzC,IAAG,GAAG,CAAC,QAAQ;oBACX,KAAI,CAAC,IAAI,CAAC,KAAK,CAAC,aAAa,GAAG,CAAC,EAAE,wBAAwB,GAAG,GAAG,CAAC,QAAQ,CAAC,CAAC;YACpF,CAAC,CAAC,CAAC;QACP,CAAC;QAEM,+BAAM,GAAb;YAAA,iBA0HC;YAzHG,IAAI,CAAC,OAAO,CAAC,IAAI,CAAC,kBAAkB,CAAC,SAAS,CAAC,CAAC;YAIhD,IAAI,CAAC,KAAK,CAAC,MAAM,CAAC;gBACd,GAAG,EAAE,QAAQ;gBACb,MAAM,EAAE,IAAI,CAAC,KAAK,CAAC,kBAAkB,CAAC,QAAQ,EAAE,EAAE,KAAK,EAAE,CAAC,EAAE,GAAG,EAAE,CAAC,EAAE,MAAM,EAAE,SAAS,EAAE,MAAM,EAAE,MAAM,EAAE,CAAC;aAC3G,CAAC,CAAC;YAEH,IAAI,CAAC,KAAK,CAAC,MAAM,CAAC;gBACd,GAAG,EAAE,MAAM;gBACX,MAAM,EAAE,IAAI,CAAC,KAAK,CAAC,kBAAkB,CAAC,QAAQ,EAAE,EAAE,KAAK,EAAE,CAAC,EAAE,GAAG,EAAE,CAAC,EAAE,MAAM,EAAE,OAAO,EAAE,MAAM,EAAE,MAAM,EAAE,CAAC;aACzG,CAAC,CAAC;YAEH,IAAI,CAAC,KAAK,CAAC,MAAM,CAAC;gBACd,GAAG,EAAE,OAAO;gBACZ,SAAS,EAAE,EAAE;gBACb,MAAM,EAAE,IAAI,CAAC,KAAK,CAAC,kBAAkB,CAAC,QAAQ,EAAE,EAAE,KAAK,EAAE,CAAC,EAAE,GAAG,EAAE,CAAC,EAAE,MAAM,EAAE,QAAQ,EAAE,MAAM,EAAE,MAAM,EAAE,CAAC;aAC1G,CAAC,CAAC;YAEH,IAAI,CAAC,KAAK,CAAC,MAAM,CAAC;gBACd,GAAG,EAAE,OAAO;gBACZ,MAAM,EAAE,IAAI,CAAC,KAAK,CAAC,kBAAkB,CAAC,QAAQ,EAAE,EAAE,KAAK,EAAE,CAAC,EAAE,GAAG,EAAE,CAAC,EAAE,MAAM,EAAE,QAAQ,EAAE,MAAM,EAAE,MAAM,EAAE,CAAC;aAC1G,CAAC,CAAC;YAIH,IAAI,cAAc,GAAG,IAAI,CAAC,iBAAiB,EAAE,CAAC;YAE9C,IAAI,CAAC,WAAW,GAAG,IAAI,CAAC,OAAO,CAAC,GAAG,CAAC,KAAK,CAAC,EAAE,SAAS,EAAE,IAAI,EAAE,YAAY,EAAE,KAAK,EAAE,CAAC,CAAC;YACpF,IAAI,CAAC,YAAY,GAAG,IAAI,CAAC,WAAW,CAAC,MAAM,CAAC,cAAc,CAAC,CAAC,EAAE,cAAc,CAAC,CAAC,EAAE,QAAQ,EAAE,cAAc,CAAC,CAAC;YAC1G,IAAI,CAAC,YAAY,CAAC,OAAO,CAAC,UAAU,EAAE,IAAI,CAAC,QAAQ,CAAC,MAAM,CAAC,CAAC;YAE5D,IAAG,IAAI,CAAC,QAAQ,CAAC,MAAM,CAAC,IAAI;gBACxB,IAAI,CAAC,YAAY,CAAC,OAAO,CAAC,QAAQ,CAAC,IAAI,CAAC,QAAQ,CAAC,MAAM,CAAC,IAAI,CAAC,MAAM,CAAC,CAAC,CAAC,EAAE,EAAE,CAAC,CAAC,CAAC;YAEjF,IAAI,CAAC,YAAY,CAAC,OAAO,CAAC,aAAa,EAAE,IAAI,CAAC,GAAG,CAAC,IAAI,CAAC,cAAc,CAAC,CAAC,EAAE,cAAc,CAAC,CAAC,GAAG,IAAI,CAAC,YAAY,CAAC,MAAM,GAAG,CAAC,GAAG,EAAE,EAAE,IAAI,CAAC,QAAQ,CAAC,MAAM,CAAC,IAAI,EAAE,SAAS,CAAC,CAAC,SAAS,CAAC,GAAG,CAAC,CAAC,CAAC;YAErL,IAAG,IAAI,CAAC,QAAQ,CAAC,MAAM,CAAC,QAAQ,EAAE;gBAC9B,IAAI,gBAAgB,GAAG,IAAI,CAAC,yBAAyB,CAAC,IAAI,CAAC,YAAY,CAAC,CAAC;gBACzE,IAAI,KAAK,GAAG,IAAI,CAAC,GAAG,CAAC,KAAK,CAAC,gBAAgB,CAAC,CAAC,EAAE,gBAAgB,CAAC,CAAC,EAAE,gBAAgB,CAAC,CAAC;gBAErF,KAAK,CAAC,QAAQ,CAAC,IAAI,CAAC,QAAQ,CAAC,cAAc,GAAG,KAAK,CAAC,MAAM,CAAC,CAAC;aAC/D;YAED,IAAG,CAAC,IAAI,CAAC,QAAQ,CAAC,MAAM,CAAC,YAAY,GAAG,4BAAY,CAAC,IAAI,CAAC,KAAK,4BAAY,CAAC,IAAI,EAAE;gBAC9E,IAAI,CAAC,YAAY,CAAC,OAAO,CAAC,WAAW,EAAE,IAAI,CAAC,GAAG,EAAE,GAAG,IAAI,CAAC,eAAe,CAAC,IAAI,CAAC,QAAQ,CAAC,MAAM,CAAC,SAAS,EAAE,IAAI,CAAC,QAAQ,CAAC,MAAM,CAAC,iBAAiB,CAAC,GAAG,IAAI,CAAC,CAAC;aAC5J;YAED,IAAG,CAAC,IAAI,CAAC,QAAQ,CAAC,MAAM,CAAC,YAAY,GAAG,4BAAY,CAAC,WAAW,CAAC,KAAK,4BAAY,CAAC,WAAW,EAAE;gBAC5F,IAAI,CAAC,YAAY,CAAC,OAAO,CAAC,kBAAkB,EAAE,IAAI,CAAC,GAAG,EAAE,GAAG,IAAI,CAAC,eAAe,CAAC,IAAI,CAAC,QAAQ,CAAC,MAAM,CAAC,gBAAgB,EAAE,IAAI,CAAC,QAAQ,CAAC,MAAM,CAAC,wBAAwB,CAAC,GAAG,IAAI,CAAC,CAAC;aACjL;oCAIQ,CAAC;gBACN,IAAI,WAAW,GAAG,OAAK,cAAc,CAAC,CAAC,CAAC,CAAC;gBACzC,IAAI,SAAS,GAA8B,OAAK,WAAW,CAAC,MAAM,CAAC,WAAW,CAAC,CAAC,EAAE,WAAW,CAAC,CAAC,EAAE,QAAQ,EAAE,YAAY,CAAC,CAAC;gBAEzH,SAAS,CAAC,OAAO,CAAC,aAAa,EAAE,OAAK,GAAG,CAAC,IAAI,CAAC,WAAW,CAAC,CAAC,EAAE,WAAW,CAAC,CAAC,GAAG,SAAS,CAAC,MAAM,GAAG,CAAC,GAAG,EAAE,EAAE,OAAK,QAAQ,CAAC,eAAe,CAAC,CAAC,CAAC,CAAC,IAAI,EAAE,SAAS,CAAC,CAAC,SAAS,CAAC,GAAG,CAAC,CAAC,CAAC;gBAE3K,IAAG,OAAK,QAAQ,CAAC,eAAe,CAAC,CAAC,CAAC,CAAC,QAAQ,EAAE;oBACtC,gBAAgB,GAAG,OAAK,sBAAsB,CAAC,CAAC,EAAE,SAAS,CAAC,CAAC;oBAC7D,KAAK,GAAG,OAAK,GAAG,CAAC,KAAK,CAAC,gBAAgB,CAAC,CAAC,EAAE,gBAAgB,CAAC,CAAC,EAAE,aAAa,GAAG,CAAC,CAAC,CAAC;oBAEtF,KAAK,CAAC,QAAQ,CAAC,OAAK,QAAQ,CAAC,cAAc,GAAG,KAAK,CAAC,MAAM,CAAC,CAAC;iBAC/D;gBAED,SAAS,CAAC,KAAK,GAAG,WAAW,CAAC,CAAC,GAAG,OAAK,YAAY,CAAC,CAAC,CAAC;gBACtD,SAAS,CAAC,OAAO,CAAC,UAAU,EAAE,OAAK,QAAQ,CAAC,eAAe,CAAC,CAAC,CAAC,CAAC,CAAC;gBAEhE,IAAG,OAAK,QAAQ,CAAC,eAAe,CAAC,CAAC,CAAC,CAAC,IAAI;oBACpC,SAAS,CAAC,OAAO,CAAC,QAAQ,CAAC,OAAK,QAAQ,CAAC,eAAe,CAAC,CAAC,CAAC,CAAC,IAAI,CAAC,MAAM,CAAC,CAAC,CAAC,EAAE,EAAE,CAAC,CAAC,CAAC;gBAErF,SAAS,CAAC,cAAc,EAAE,CAAC;gBAC3B,SAAS,CAAC,EAAE,CAAC,aAAa,EAAE,UAAC,CAAC;oBAC1B,IAAI,KAAI,CAAC,aAAa,EAAE;wBAEpB,KAAI,CAAC,YAAY,CAAC,KAAK,GAAG,KAAI,CAAC,KAAK,CAAC,CAAC,GAAG,KAAI,CAAC,YAAY,CAAC,CAAC,CAAC;wBAE7D,IAAI,cAAY,GAAG,KAAI,CAAC,qBAAqB,CAAC,KAAI,CAAC,YAAY,CAAC,CAAC;wBACjE,KAAI,CAAC,UAAU,CAAC,CAAC,GAAG,cAAY,CAAC,CAAC,CAAC;wBACnC,KAAI,CAAC,UAAU,CAAC,CAAC,GAAG,cAAY,CAAC,CAAC,CAAC;wBAEnC,KAAI,CAAC,SAAS,CAAC,KAAI,CAAC,YAAY,EAAE,SAAS,CAAC,CAAC;qBAChD;gBACL,CAAC,CAAC,CAAC;gBAEH,IAAG,CAAC,OAAK,QAAQ,CAAC,eAAe,CAAC,CAAC,CAAC,CAAC,YAAY,GAAG,4BAAY,CAAC,IAAI,CAAC,KAAK,4BAAY,CAAC,IAAI,EAAE;oBAC1F,SAAS,CAAC,OAAO,CAAC,WAAW,EAAE,IAAI,CAAC,GAAG,EAAE,GAAG,OAAK,eAAe,CAAC,OAAK,QAAQ,CAAC,eAAe,CAAC,CAAC,CAAC,CAAC,SAAS,EAAE,OAAK,QAAQ,CAAC,eAAe,CAAC,CAAC,CAAC,CAAC,iBAAiB,CAAC,GAAG,IAAI,CAAC,CAAC;iBAC5K;gBAED,IAAG,CAAC,OAAK,QAAQ,CAAC,eAAe,CAAC,CAAC,CAAC,CAAC,YAAY,GAAG,4BAAY,CAAC,WAAW,CAAC,KAAK,4BAAY,CAAC,WAAW,EAAE;oBACxG,SAAS,CAAC,OAAO,CAAC,kBAAkB,EAAE,IAAI,CAAC,GAAG,EAAE,GAAG,OAAK,eAAe,CAAC,OAAK,QAAQ,CAAC,eAAe,CAAC,CAAC,CAAC,CAAC,gBAAgB,EAAE,OAAK,QAAQ,CAAC,eAAe,CAAC,CAAC,CAAC,CAAC,wBAAwB,CAAC,GAAG,IAAI,CAAC,CAAC;iBACjM;gBAED,OAAK,UAAU,CAAC,IAAI,CAAC,SAAS,CAAC,CAAC;;+BAlCxB,gBAAgB,EAChB,KAAK;YARjB,KAAK,IAAI,CAAC,GAAG,CAAC,EAAE,CAAC,GAAG,IAAI,CAAC,QAAQ,CAAC,eAAe,CAAC,MAAM,EAAE,CAAC,EAAE;wBAApD,CAAC;aA0CT;YAID,IAAI,YAAY,GAAG,IAAI,CAAC,qBAAqB,CAAC,IAAI,CAAC,YAAY,CAAC,CAAC;YACjE,IAAI,CAAC,UAAU,GAAG,IAAI,CAAC,OAAO,CAAC,GAAG,CAAC,MAAM,CAAC,YAAY,CAAC,CAAC,EAAE,YAAY,CAAC,CAAC,EAAE,MAAM,CAAC,CAAC;YAElF,IAAG,IAAI,CAAC,QAAQ,CAAC,QAAQ;gBACrB,IAAI,CAAC,UAAU,CAAC,OAAO,CAAC,QAAQ,CAAC,IAAI,CAAC,QAAQ,CAAC,QAAQ,CAAC,MAAM,CAAC,CAAC,CAAC,EAAE,EAAE,CAAC,CAAC,CAAC;YAE5E,IAAI,CAAC,OAAO,CAAC,GAAG,CAAC,OAAO,CAAC,IAAI,CAAC,UAAU,EAAE,IAAI,CAAC,WAAW,EAAE,UAAC,EAAE,EAAE,QAAQ;gBACrE,IAAI,CAAC,KAAI,CAAC,QAAQ,IAAI,QAAQ,KAAK,KAAI,CAAC,WAAW;oBAC/C,KAAI,CAAC,SAAS,CAAC,QAAqC,CAAC,CAAC;YAC9D,CAAC,CAAC,CAAC;YAIH,IAAI,CAAC,SAAS,GAAG,IAAI,CAAC,GAAG,EAAE,CAAC;YAC5B,IAAI,CAAC,QAAQ,GAAG,IAAI,CAAC,SAAS,CAAC;YAE/B,IAAI,IAAI,CAAC,QAAQ,CAAC,SAAS,GAAG,CAAC,IAAI,IAAI,CAAC,QAAQ,CAAC,gBAAgB,EAAE;gBAC/D,IAAI,CAAC,aAAa,GAAG,IAAI,CAAC,GAAG,CAAC,IAAI,CAAC,IAAI,CAAC,GAAG,CAAC,MAAM,CAAC,KAAK,GAAG,EAAE,EAAE,EAAE,EAAE,IAAI,CAAC,aAAa,EAAE,EAAE,SAAS,CAAC,CAAC;gBACpG,IAAI,CAAC,aAAa,CAAC,SAAS,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC;aACtC;QACL,CAAC;QAEM,+BAAM,GAAb;YAAA,iBAmEC;YAlEG,IAAG,IAAI,CAAC,SAAS;gBACb,OAAO;YAEX,IAAI,IAAI,CAAC,aAAa,EAAE;gBACpB,IAAI,CAAC,YAAY,CAAC,IAAI,CAAC,QAAQ,CAAC,CAAC;gBACjC,IAAI,CAAC,YAAY,CAAC,KAAK,GAAG,IAAI,CAAC,KAAK,CAAC,CAAC,GAAG,IAAI,CAAC,YAAY,CAAC,CAAC,CAAC;gBAE7D,IAAI,YAAY,GAAG,IAAI,CAAC,qBAAqB,CAAC,IAAI,CAAC,YAAY,CAAC,CAAC;gBACjE,IAAI,CAAC,UAAU,CAAC,CAAC,GAAG,YAAY,CAAC,CAAC,CAAC;gBACnC,IAAI,CAAC,UAAU,CAAC,CAAC,GAAG,YAAY,CAAC,CAAC,CAAC;aACtC;iBAAM,IAAI,CAAC,IAAI,CAAC,QAAQ,EAAE;gBAEvB,IAAI,CAAC,WAAW,CAAC,WAAW,EAAE,CAAC,OAAO,CAAC,UAAA,CAAC;oBACpC,IAAI,MAAM,GAAG,CAA8B,CAAC;oBAC5C,IAAI,MAAM,CAAC,KAAK,CAAC,IAAI,CAAC,QAAQ,CAAC,MAAM,CAAC;wBAClC,MAAM,CAAC,KAAK,GAAG,KAAI,CAAC,UAAU,CAAC,CAAC,GAAG,MAAM,CAAC,CAAC,CAAA;gBACnD,CAAC,CAAC,CAAC;aACN;YAGD,IAAG,CAAC,IAAI,CAAC,eAAe,IAAI,CAAC,IAAI,CAAC,QAAQ,CAAC,MAAM,CAAC,YAAY,GAAG,4BAAY,CAAC,IAAI,CAAC,KAAK,4BAAY,CAAC,IAAI;gBACjG,IAAI,CAAC,GAAG,EAAE,GAAG,IAAI,CAAC,YAAY,CAAC,OAAO,CAAC,WAAW,CAAC,EAAE;gBACzD,IAAI,CAAC,eAAe,GAAG,IAAI,CAAC;gBAC5B,IAAI,CAAC,SAAS,CAAC,kBAAkB,EAAE;oBAC/B,MAAM,EAAE,cAAc;iBACzB,CAAC,CAAC;aACN;iBAEI,IAAI,CAAC,IAAI,CAAC,aAAa,IAAI,CAAC,IAAI,CAAC,eAAe,IAAI,CAAC,IAAI,CAAC,QAAQ,CAAC,MAAM,CAAC,YAAY,GAAG,4BAAY,CAAC,WAAW,CAAC,KAAK,4BAAY,CAAC,WAAW;gBACxI,IAAI,CAAC,GAAG,EAAE,GAAG,IAAI,CAAC,YAAY,CAAC,OAAO,CAAC,kBAAkB,CAAC,EAAE;gBACpE,IAAI,CAAC,eAAe,GAAG,IAAI,CAAC;gBAC5B,IAAI,CAAC,SAAS,CAAC,kBAAkB,EAAE;oBAC/B,MAAM,EAAE,cAAc;iBACzB,CAAC,CAAC;aACN;YAED,IAAI,CAAC,UAAU,CAAC,OAAO,CAAC,UAAA,GAAG;gBAIvB,IAAI,GAAG,IAAI,KAAI,CAAC,WAAW,IAAI,GAAG,CAAC,OAAO,CAAC,QAAQ,CAAC;oBAChD,OAAO;gBAEX,IAAI,QAAQ,GAAG,GAAG,CAAC,OAAO,CAAC,UAAU,CAAqB,CAAC;gBAG3D,IAAG,CAAC,QAAQ,CAAC,YAAY,GAAG,4BAAY,CAAC,IAAI,CAAC,KAAK,4BAAY,CAAC,IAAI;oBAC5D,IAAI,CAAC,GAAG,EAAE,GAAG,GAAG,CAAC,OAAO,CAAC,WAAW,CAAC,EAAE;oBAC3C,KAAI,CAAC,SAAS,CAAC,GAAG,EAAE,cAAc,CAAC,CAAC;iBACvC;qBAEI,IAAI,CAAC,QAAQ,CAAC,YAAY,GAAG,4BAAY,CAAC,WAAW,CAAC,KAAK,4BAAY,CAAC,WAAW;oBAChF,IAAI,CAAC,GAAG,EAAE,GAAG,GAAG,CAAC,OAAO,CAAC,kBAAkB,CAAC,EAAE;oBAClD,KAAI,CAAC,SAAS,CAAC,GAAG,EAAE,cAAc,CAAC,CAAC;iBACvC;YACL,CAAC,CAAC,CAAC;YAIH,IAAI,IAAI,CAAC,QAAQ,CAAC,SAAS,GAAG,CAAC,IAAI,IAAI,CAAC,QAAQ,CAAC,gBAAgB;gBAC7D,IAAI,CAAC,aAAa,CAAC,OAAO,CAAC,IAAI,CAAC,aAAa,EAAE,CAAC,CAAC;YAErD,IAAI,IAAI,CAAC,QAAQ,CAAC,SAAS,GAAG,CAAC,IAAI,IAAI,CAAC,GAAG,EAAE,GAAG,IAAI,CAAC,SAAS,GAAG,IAAI,CAAC,QAAQ,CAAC,SAAS,EAAE;gBACtF,IAAI,CAAC,SAAS,CAAC,mBAAmB,CAAC,CAAC;gBACpC,IAAI,CAAC,QAAQ,EAAE,CAAC;aACnB;QACL,CAAC;QAEM,iCAAQ,GAAf;YACI,IAAI,IAAI,CAAC,SAAS;gBACd,OAAO;YAEX,IAAI,CAAC,SAAS,GAAG,IAAI,CAAC;YAEtB,IAAI,CAAC,SAAS,CAAC,UAAU,CAAC,CAAC;YAG3B,YAAY,CAAC,IAAI,CAAC,aAAa,CAAC,CAAC;YACjC,IAAI,CAAC,WAAW,CAAC,QAAQ,CAAC,OAAO,CAAC,UAAA,KAAK;gBACnC,KAAK,CAAC,kBAAkB,EAAE,CAAC;gBAC3B,OAAO,IAAI,CAAC;YAChB,CAAC,CAAC,CAAC;YAGH,IAAI,CAAC,GAAG,CAAC,SAAS,CAAC,IAAI,CAAC,GAAG,CAAC,MAAM,CAAC,KAAK,GAAG,CAAC,EAAE,IAAI,CAAC,GAAG,CAAC,MAAM,CAAC,MAAM,GAAG,CAAC,EAAE,IAAI,CAAC,GAAG,CAAC,MAAM,CAAC,KAAK,EAAE,IAAI,CAAC,GAAG,CAAC,MAAM,CAAC,MAAM,EAAE,QAAQ,EAAE,IAAI,CAAC,QAAQ,CAAC,eAAe,CAAC,CAAC;YAClK,IAAI,CAAC,GAAG,CAAC,IAAI,CAAC,IAAI,CAAC,GAAG,CAAC,MAAM,CAAC,KAAK,GAAG,CAAC,EAAE,IAAI,CAAC,GAAG,CAAC,MAAM,CAAC,MAAM,GAAG,CAAC,EAAE,IAAI,CAAC,QAAQ,CAAC,YAAY,EAAE,SAAS,CAAC,CAAC,SAAS,CAAC,GAAG,CAAC,CAAC;QAC/H,CAAC;QAIM,kCAAS,GAAhB,UAAiB,OAAkC,EAAE,QAAmC;YACpF,IAAI,CAAC,SAAS,CAAC,OAAO,EAAE;gBACpB,OAAO,EAAE,OAAO,CAAC,OAAO,CAAC,UAAU,CAAC,CAAC,IAAI;gBACzC,QAAQ,EAAE,QAAQ,CAAC,OAAO,CAAC,UAAU,CAAC,CAAC,IAAI;gBAC3C,IAAI,EAAE,IAAI,CAAC,GAAG,EAAE,GAAG,IAAI,CAAC,QAAQ;aACnC,CAAC,CAAC;YAEH,IAAI,CAAC,QAAQ,GAAG,IAAI,CAAC,GAAG,EAAE,CAAC;YAK3B,IAAI,eAAe,GAAG,OAAO,CAAC,OAAO,CAAC,UAAU,CAAC,CAAC;YAElD,IAAG,CAAC,eAAe,CAAC,YAAY,GAAG,4BAAY,CAAC,WAAW,CAAC,KAAK,4BAAY,CAAC,WAAW,EAAE;gBACvF,QAAQ,CAAC,OAAO,CAAC,kBAAkB,EAAE,IAAI,CAAC,GAAG,EAAE,GAAG,IAAI,CAAC,eAAe,CAAC,eAAe,CAAC,gBAAgB,EAAE,eAAe,CAAC,wBAAwB,CAAC,GAAG,IAAI,CAAC,CAAC;aAC9J;YAED,IAAI,CAAC,aAAa,GAAG,IAAI,CAAC,QAAQ,GAAG,KAAK,CAAC;YAC3C,IAAI,CAAC,WAAW,GAAG,QAAQ,CAAC;YAE5B,IAAI,CAAC,UAAU,EAAE,CAAC;YAIlB,OAAO,CAAC,IAAI,CAAC,OAAO,CAAC,CAAC;YACtB,OAAO,CAAC,eAAe,CAAC,MAAM,CAAC,CAAC;YAIhC,IAAI,kBAAkB,GAAG,IAAI,CAAC,qBAAqB,CAAC,QAAQ,CAAC,CAAC;YAC9D,IAAI,CAAC,OAAO,CAAC,MAAM,CAAC,IAAI,CAAC,UAAU,EAAE,kBAAkB,CAAC,CAAC,EAAE,kBAAkB,CAAC,CAAC,EAAE,IAAI,CAAC,QAAQ,CAAC,SAAS,CAAC,CAAC;QAC9G,CAAC;QAEM,kCAAS,GAAhB,UAAiB,QAAmC;YAApD,iBA+HC;;YA5HG,IAAI,CAAC,QAAQ,GAAG,IAAI,CAAC;YACrB,QAAQ,CAAC,OAAO,CAAC,eAAe,EAAE,CAAC,CAAC,CAAA;YAIpC,QAAQ,CAAC,IAAI,CAAC,OAAO,CAAC,CAAC;YAIvB,IAAI,YAAY,GAAG,IAAI,CAAC,qBAAqB,CAAC,QAAQ,CAAC,CAAC;YACvD,IAAI,CAAC,UAAU,CAAC,IAAmC,CAAC,KAAK,CAAC,YAAY,CAAC,CAAC,EAAE,YAAY,CAAC,CAAC,CAAC,CAAC;YAK3F,IAAG,CAAC,IAAI,CAAC,eAAe,IAAI,CAAC,IAAI,CAAC,QAAQ,CAAC,MAAM,CAAC,YAAY,GAAG,4BAAY,CAAC,IAAI,CAAC,KAAK,4BAAY,CAAC,IAAI,EAAE;gBACvG,IAAI,WAAW,GAAG,IAAI,CAAC,eAAe,CAAC,IAAI,CAAC,QAAQ,CAAC,MAAM,CAAC,SAAS,EAAE,IAAI,CAAC,QAAQ,CAAC,MAAM,CAAC,iBAAiB,CAAC,CAAC;gBAE/G,IAAI,IAAI,CAAC,UAAU,IAAI,WAAW,EAAE;oBAChC,IAAI,CAAC,eAAe,GAAG,IAAI,CAAC;oBAC5B,IAAI,CAAC,SAAS,CAAC,kBAAkB,EAAE;wBAC/B,MAAM,EAAE,gBAAgB;qBAC3B,CAAC,CAAC;iBACN;aACJ;iBAEI,IAAG,CAAC,IAAI,CAAC,eAAe,IAAI,CAAC,IAAI,CAAC,QAAQ,CAAC,MAAM,CAAC,YAAY,GAAG,4BAAY,CAAC,OAAO,CAAC,KAAK,4BAAY,CAAC,OAAO,EAAE;gBAClH,IAAI,WAAW,GAAG,IAAI,CAAC,eAAe,CAAC,IAAI,CAAC,QAAQ,CAAC,MAAM,CAAC,YAAY,EAAE,IAAI,CAAC,QAAQ,CAAC,MAAM,CAAC,oBAAoB,CAAC,CAAC;gBACrH,IAAI,mBAAmB,GAAG,MAAA,IAAI,CAAC,YAAY,CAAC,OAAO,CAAC,eAAe,CAAC,mCAAI,CAAC,CAAC;gBAE1E,IAAG,IAAI,CAAC,YAAY,IAAI,QAAQ;oBAC5B,IAAI,CAAC,YAAY,CAAC,OAAO,CAAC,eAAe,EAAE,EAAE,mBAAmB,CAAC,CAAC;gBAEtE,IAAI,mBAAmB,IAAI,WAAW,EAAE;oBACpC,IAAI,CAAC,eAAe,GAAG,IAAI,CAAC;oBAC5B,IAAI,CAAC,SAAS,CAAC,kBAAkB,EAAE;wBAC/B,MAAM,EAAE,gBAAgB;qBAC3B,CAAC,CAAC;iBACN;aACJ;YAED,IAAI,CAAC,UAAU,CAAC,OAAO,CAAC,UAAA,GAAG;;gBAIvB,IAAI,GAAG,IAAI,QAAQ,IAAI,GAAG,CAAC,OAAO,CAAC,QAAQ,CAAC;oBACxC,OAAO;gBAEX,IAAI,QAAQ,GAAG,GAAG,CAAC,OAAO,CAAC,UAAU,CAAqB,CAAC;gBAC3D,IAAI,aAAa,GAAG,CAAC,MAAA,GAAG,CAAC,OAAO,CAAC,eAAe,CAAC,mCAAI,CAAC,CAAC,GAAG,CAAC,CAAC;gBAC5D,GAAG,CAAC,OAAO,CAAC,eAAe,EAAE,aAAa,CAAC,CAAC;gBAG5C,IAAG,CAAC,QAAQ,CAAC,YAAY,GAAG,4BAAY,CAAC,IAAI,CAAC,KAAK,4BAAY,CAAC,IAAI,EAAE;oBAClE,IAAI,WAAW,GAAG,KAAI,CAAC,eAAe,CAAC,QAAQ,CAAC,SAAS,EAAE,QAAQ,CAAC,iBAAiB,CAAC,CAAC;oBAEvF,IAAI,KAAI,CAAC,UAAU,IAAI,WAAW,IAAI,KAAI,CAAC,WAAW,CAAC,QAAQ,CAAC,eAAe,CAAC;wBAC5E,KAAI,CAAC,SAAS,CAAC,GAAG,EAAE,gBAAgB,CAAC,CAAC;iBAC7C;qBAEI,IAAG,CAAC,QAAQ,CAAC,YAAY,GAAG,4BAAY,CAAC,OAAO,CAAC,KAAK,4BAAY,CAAC,OAAO,EAAE;oBAC7E,IAAI,WAAW,GAAG,KAAI,CAAC,eAAe,CAAC,QAAQ,CAAC,YAAY,EAAE,QAAQ,CAAC,oBAAoB,CAAC,CAAC;oBAE7F,IAAI,aAAa,IAAI,WAAW,IAAI,KAAI,CAAC,WAAW,CAAC,QAAQ,CAAC,kBAAkB,CAAC;wBAC7E,KAAI,CAAC,SAAS,CAAC,GAAG,EAAE,gBAAgB,CAAC,CAAC;iBAC7C;YACL,CAAC,CAAC,CAAC;YAIH,IACI,CAAC,IAAI,CAAC,QAAQ,CAAC,WAAW,IAAI,IAAI,CAAC,aAAa,KAAK,IAAI,CAAC,QAAQ,CAAC,QAAQ,CAAC,MAAM,CAAC;gBACnF,CAAC,IAAI,CAAC,QAAQ,CAAC,WAAW,IAAI,IAAI,CAAC,QAAQ,CAAC,wBAAwB,IAAI,IAAI,CAAC,UAAU,IAAI,IAAI,CAAC,QAAQ,CAAC,UAAU,CAAC;gBACpH,CAAC,CAAC,IAAI,CAAC,QAAQ,CAAC,WAAW,IAAI,IAAI,CAAC,UAAU,IAAI,IAAI,CAAC,QAAQ,CAAC,UAAU,CAAC,EAC7E;gBACE,IAAI,CAAC,SAAS,CAAC,iBAAiB,CAAC,CAAC;gBAClC,IAAI,CAAC,QAAQ,EAAE,CAAC;gBAChB,OAAO;aACV;YAID,IAAI,QAAQ,KAAK,IAAI,CAAC,YAAY,EAAE;gBAChC,IAAI,CAAC,aAAa,GAAG,IAAI,CAAC;aAC7B;iBAAM;gBACH,IAAI,UAAQ,GAAG,QAAQ,CAAC,OAAO,CAAC,UAAU,CAAqB,CAAC;gBAEhE,IAAI,CAAC,aAAa,GAAG,UAAU,CAAC;oBAC5B,QAAQ,CAAC,IAAI,CAAC,QAAQ,CAAC,CAAC;oBAExB,YAAY,GAAG,KAAI,CAAC,qBAAqB,CAAC,QAAQ,CAAC,CAAC;oBACpD,KAAI,CAAC,UAAU,CAAC,CAAC,GAAG,YAAY,CAAC,CAAC,CAAC;oBACnC,KAAI,CAAC,UAAU,CAAC,CAAC,GAAG,YAAY,CAAC,CAAC,CAAC;oBAEnC,KAAI,CAAC,aAAa,GAAG,UAAU,CAAC;wBAC5B,IAAI,KAAI,CAAC,QAAQ,CAAC,WAAW,EAAE;4BAE3B,OAAM,KAAI,CAAC,QAAQ,CAAC,QAAQ,CAAC,KAAI,CAAC,aAAa,CAAC,KAAK,KAAI,CAAC,WAAW,CAAC,WAAW,EAAE,CAAC,OAAO,CAAC,QAAQ,CAAC;gCACjG,CAAC,KAAI,CAAC,aAAa,CAAC,QAAQ,CAAC,KAAI,CAAC,QAAQ,CAAC,QAAQ,CAAC,KAAI,CAAC,aAAa,CAAC,CAAC;gCACxE,KAAI,CAAC,aAAa,EAAE,CAAA;4BAExB,KAAI,CAAC,SAAS,CAAC,QAAQ,EAAE,KAAI,CAAC,WAAW,CAAC,WAAW,EAAE,CAAC,KAAI,CAAC,QAAQ,CAAC,QAAQ,CAAC,KAAI,CAAC,aAAa,CAAC,CAA8B,CAAC,CAAA;4BACjI,KAAI,CAAC,aAAa,EAAE,CAAC;yBACxB;6BAAM;4BACH,IAAI,MAAM,GAAG,IAAI,CAAC,MAAM,EAAE,GAAG,GAAG,CAAC;4BAGjC,KAAK,IAAI,CAAC,GAAG,CAAC,EAAE,CAAC,GAAG,UAAQ,CAAC,gBAAgB,CAAC,MAAM,EAAE,CAAC,EAAE,EAAE;gCACvD,MAAM,IAAI,UAAQ,CAAC,gBAAgB,CAAC,CAAC,CAAC,CAAC;gCAEvC,IAAI,MAAM,IAAI,CAAC,EAAE;oCAEb,IAAI,CAAC,IAAI,KAAI,CAAC,WAAW,CAAC,WAAW,EAAE,CAAC,OAAO,CAAC,QAAQ,CAAC;wCACrD,CAAC,EAAE,CAAA;oCAEP,KAAI,CAAC,SAAS,CAAC,QAAQ,EAAE,KAAI,CAAC,WAAW,CAAC,WAAW,EAAE,CAAC,CAAC,CAA8B,CAAC,CAAC;oCAEzF,MAAM;iCACT;6BACJ;yBACJ;oBACL,CAAC,EAAE,KAAI,CAAC,eAAe,CAAC,UAAQ,CAAC,UAAU,EAAE,UAAQ,CAAC,kBAAkB,CAAC,CAAC,CAAC;gBAC/E,CAAC,EAAE,IAAI,CAAC,eAAe,CAAC,UAAQ,CAAC,UAAU,EAAE,UAAQ,CAAC,kBAAkB,CAAC,CAAC,CAAA;aAC7E;QACL,CAAC;QAEM,kCAAS,GAAhB,UAAiB,MAAiC,EAAE,MAAmB;YAAvE,iBA4EC;YA5EmD,uBAAA,EAAA,WAAmB;YACnE,IAAI,UAAU,GAAG,MAAM,CAAC,OAAO,CAAC,aAAa,CAA4B,CAAC;YAC1E,IAAI,WAAW,GAAG,IAAI,CAAC,WAAW,CAAC,WAAW,EAAE,CAAC,OAAO,CAAC,MAAM,CAAC,CAAC;YAEjE,IAAI,CAAC,aAAa,CAAC,IAAI,CAAC,WAAW,CAAC,CAAC;YACrC,MAAM,CAAC,OAAO,CAAC,QAAQ,EAAE,IAAI,CAAC,CAAC;YAE/B,UAAU,CAAC,OAAO,CAAC,CAAC,UAAU,CAAC,IAAI,EAAE,oBAAoB,CAAC,CAAC,CAAC;YAI5D,MAAM,CAAC,kBAAkB,EAAE,CAAC;YAC5B,MAAM,CAAC,UAAU,CAAC,KAAK,CAAC,CAAC;YAEzB,IAAI,CAAC,SAAS,CAAC,OAAO,EAAE;gBACpB,MAAM,EAAE,MAAM,CAAC,OAAO,CAAC,UAAU,CAAC,CAAC,IAAI;gBACvC,MAAM,EAAE,MAAM;aACjB,CAAC,CAAC;YAIH,OAAO,CAAC,GAAG,CAAC,QAAQ,EAAE,WAAW,CAAC,CAAC;YAEnC,IAAI,CAAC,QAAQ,CAAC,eAAe,CAAC,OAAO,CAAC,UAAC,GAAG,EAAE,CAAC;gBACzC,IAAG,KAAI,CAAC,aAAa,CAAC,QAAQ,CAAC,CAAC,GAAG,CAAC,CAAC;oBACjC,OAAO;gBAEX,OAAO,CAAC,GAAG,CAAC,mBAAmB,EAAE,CAAC,EAAE,GAAG,CAAC,gBAAgB,CAAC,CAAC;gBAE1D,IAAI,WAAW,GAAG,WAAW,GAAG,CAAC,CAAC,GAAG,CAAC,CAAC,CAAC,CAAC,CAAC,WAAW,GAAG,CAAC,CAAC,CAAC,CAAC,WAAW,CAAC;gBACxE,IAAI,YAAY,GAAG,GAAG,CAAC,gBAAgB,CAAC,WAAW,CAAC,CAAC;gBACrD,GAAG,CAAC,gBAAgB,CAAC,WAAW,CAAC,GAAG,CAAC,CAAC;gBACtC,IAAI,KAAK,GAAG,GAAG,CAAC,gBAAgB,CAAC,MAAM,CAAC,UAAC,GAAG,EAAE,GAAG,IAAK,OAAA,GAAG,GAAG,GAAG,EAAT,CAAS,CAAC,CAAC;gBAEjE,KAAI,IAAI,CAAC,GAAG,CAAC,EAAE,CAAC,GAAG,GAAG,CAAC,gBAAgB,CAAC,MAAM,EAAE,CAAC,EAAE,EAAE;oBACjD,IAAI,GAAG,CAAC,gBAAgB,CAAC,CAAC,CAAC,IAAI,CAAC;wBAC5B,SAAS;oBAEb,GAAG,CAAC,gBAAgB,CAAC,CAAC,CAAC,IAAI,GAAG,CAAC,gBAAgB,CAAC,CAAC,CAAC,GAAG,KAAK,GAAG,YAAY,CAAC;iBAC7E;gBAED,OAAO,CAAC,GAAG,CAAC,kBAAkB,EAAE,CAAC,EAAE,GAAG,CAAC,gBAAgB,CAAC,CAAC;YAC7D,CAAC,CAAC,CAAC;YAGH,IAAI,IAAI,CAAC,aAAa,CAAC,MAAM,IAAI,IAAI,CAAC,QAAQ,CAAC,eAAe,CAAC,MAAM,EAAE;gBACnE,IAAI,CAAC,QAAQ,EAAE,CAAC;gBAChB,OAAO;aACV;YAID,IAAG,CAAC,IAAI,CAAC,eAAe,IAAI,CAAC,IAAI,CAAC,QAAQ,CAAC,MAAM,CAAC,YAAY,GAAG,4BAAY,CAAC,WAAW,CAAC,KAAK,4BAAY,CAAC,WAAW,EAAE;gBACrH,OAAO,CAAC,GAAG,CAAC,IAAI,CAAC,aAAa,CAAC,MAAM,EAAE,IAAI,CAAC,QAAQ,CAAC,MAAM,CAAC,gBAAgB,CAAC,CAAC;gBAC9E,IAAI,IAAI,CAAC,aAAa,CAAC,MAAM,IAAI,IAAI,CAAC,QAAQ,CAAC,MAAM,CAAC,gBAAgB,EAAE;oBACpE,IAAI,CAAC,eAAe,GAAG,IAAI,CAAC;oBAC5B,IAAI,CAAC,SAAS,CAAC,kBAAkB,EAAE;wBAC/B,MAAM,EAAE,eAAe;qBAC1B,CAAC,CAAC;iBACN;aACJ;YAED,IAAI,CAAC,UAAU,CAAC,OAAO,CAAC,UAAA,GAAG;gBACvB,IAAI,QAAQ,GAAG,GAAG,CAAC,OAAO,CAAC,UAAU,CAAqB,CAAC;gBAK3D,IAAI,GAAG,IAAI,KAAI,CAAC,WAAW,IAAI,GAAG,CAAC,OAAO,CAAC,QAAQ,CAAC;oBAChD,OAAO;gBAEX,IAAG,CAAC,QAAQ,CAAC,YAAY,GAAG,4BAAY,CAAC,WAAW,CAAC,KAAK,4BAAY,CAAC,WAAW,EAAE;oBAChF,IAAI,KAAI,CAAC,aAAa,CAAC,MAAM,IAAI,QAAQ,CAAC,gBAAgB,IAAI,KAAI,CAAC,WAAW,CAAC,QAAQ,CAAC,sBAAsB,CAAC;wBAC3G,KAAI,CAAC,SAAS,CAAC,GAAG,EAAE,eAAe,CAAC,CAAC;iBAC5C;YACL,CAAC,CAAC,CAAC;QACP,CAAC;QAID,uCAAc,GAAd,UAAe,CAAS;YAEpB,IAAI,OAAO,GAAG,EAAE,CAAC;YACjB,IAAI,YAAY,GAAG,IAAI,CAAC,QAAQ,CAAC,YAAY,CAAC,CAAC,CAAC,IAAI,CAAC,QAAQ,CAAC,cAAc,GAAG,IAAI,CAAC,QAAQ,CAAC,eAAe,GAAG,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC;YAErH,IAAG,IAAI,CAAC,QAAQ,CAAC,eAAe,CAAC,MAAM,KAAK,CAAC,EAAE;gBAC3C,OAAO,IAAI,gBAAM,CAAC,IAAI,CAAC,KAAK,CACxB,IAAI,CAAC,GAAG,CAAC,MAAM,CAAC,KAAK,GAAG,CAAC,EACzB,OAAO,GAAG,YAAY,CACzB,CAAC;aACL;YAED,OAAO,IAAI,gBAAM,CAAC,IAAI,CAAC,KAAK,CAExB,CAAC,CAAC,IAAI,CAAC,GAAG,CAAC,MAAM,CAAC,KAAK,GAAG,CAAC,OAAO,GAAG,CAAC,CAAC,CAAC,GAAG,CAAC,IAAI,CAAC,QAAQ,CAAC,eAAe,CAAC,MAAM,GAAG,CAAC,CAAC,CAAC,GAAG,CAAC,GAAG,OAAO,EAEpG,CAAC,KAAK,CAAC,IAAI,CAAC,KAAK,IAAI,CAAC,QAAQ,CAAC,eAAe,CAAC,MAAM,GAAG,CAAC;gBACrD,CAAC,CAAC,CAAC,IAAI,CAAC,GAAG,CAAC,MAAM,CAAC,MAAM,GAAG,CAAC,CAAC;gBAC9B,CAAC,CAAC,OAAO,GAAG,YAAY,CAC/B,CAAC;QACN,CAAC;QAED,+CAAsB,GAAtB,UAAuB,CAAS,EAAE,MAAiC;YAC/D,IAAI,QAAQ,GAAG,IAAI,CAAC,cAAc,CAAC,CAAC,CAAC,CAAC;YAEtC,OAAO,IAAI,gBAAM,CAAC,IAAI,CAAC,KAAK,CACxB,QAAQ,CAAC,CAAC,EACV,QAAQ,CAAC,CAAC,GAAG,IAAI,CAAC,QAAQ,CAAC,cAAc,GAAG,IAAI,CAAC,QAAQ,CAAC,eAAe,GAAG,CAAC,GAAG,MAAM,CAAC,MAAM,GAAG,CAAC,CACpG,CAAC;QACN,CAAC;QAED,0CAAiB,GAAjB;YACI,IAAI,OAAO,GAAG,EAAE,CAAC;YAEjB,IAAG,IAAI,CAAC,QAAQ,CAAC,YAAY;gBACzB,OAAO,IAAI,IAAI,CAAC,QAAQ,CAAC,cAAc,GAAG,IAAI,CAAC,QAAQ,CAAC,eAAe,GAAG,CAAC,CAAC;YAEhF,OAAO,IAAI,gBAAM,CAAC,IAAI,CAAC,KAAK,CACxB,IAAI,CAAC,GAAG,CAAC,MAAM,CAAC,KAAK,GAAG,CAAC,EACzB,IAAI,CAAC,GAAG,CAAC,MAAM,CAAC,MAAM,GAAG,OAAO,CACnC,CAAC;QACN,CAAC;QAED,kDAAyB,GAAzB,UAA0B,MAAiC;YACvD,IAAI,QAAQ,GAAG,IAAI,CAAC,iBAAiB,EAAE,CAAC;YAExC,OAAO,IAAI,gBAAM,CAAC,IAAI,CAAC,KAAK,CACxB,QAAQ,CAAC,CAAC,EACV,QAAQ,CAAC,CAAC,GAAG,IAAI,CAAC,QAAQ,CAAC,cAAc,GAAG,CAAC,GAAG,IAAI,CAAC,QAAQ,CAAC,eAAe,GAAG,CAAC,GAAG,MAAM,CAAC,MAAM,GAAG,CAAC,GAAG,EAAE,CAC7G,CAAC;QACN,CAAC;QAGD,8CAAqB,GAArB,UAAsB,MAAiC;YACnD,OAAO,IAAI,gBAAM,CAAC,IAAI,CAAC,KAAK,CAAC,MAAM,CAAC,CAAC,GAAG,CAAC,MAAM,CAAC,KAAK,CAAC,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,EAAE,CAAC,EAAE,MAAM,CAAC,CAAC,GAAG,EAAE,CAAC,CAAC;QACtF,CAAC;QAGD,8CAAqB,GAArB,UAAsB,MAAiC;YACnD,OAAO,IAAI,gBAAM,CAAC,IAAI,CAAC,KAAK,CAAC,MAAM,CAAC,CAAC,GAAG,CAAC,MAAM,CAAC,KAAK,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,CAAC,EAAE,CAAC,EAAE,MAAM,CAAC,CAAC,GAAG,EAAE,CAAC,CAAC;QACtF,CAAC;QAED,wCAAe,GAAf,UAAgB,IAAY,EAAE,QAAgB;YAC1C,OAAO,IAAI,GAAG,CAAC,gBAAM,CAAC,IAAI,CAAC,GAAG,CAAC,OAAO,CAAC,CAAC,EAAE,QAAQ,CAAC,GAAG,gBAAM,CAAC,IAAI,CAAC,GAAG,CAAC,IAAI,EAAE,CAAC,CAAC;QAClF,CAAC;QAED,oCAAW,GAAX,UAAY,MAAc;YACtB,OAAO,gBAAM,CAAC,IAAI,CAAC,GAAG,CAAC,OAAO,CAAC,CAAC,EAAE,GAAG,CAAC,IAAI,MAAM,CAAC;QACrD,CAAC;QAED,sCAAa,GAAb;YACI,IAAI,aAAa,GAAG,IAAI,CAAC,QAAQ,CAAC,SAAS,GAAG,CAAC,IAAI,CAAC,GAAG,EAAE,GAAG,IAAI,CAAC,SAAS,CAAC,CAAC;YAC5E,IAAI,IAAI,GAAG,IAAI,IAAI,CAAC,aAAa,GAAG,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,aAAa,CAAC,CAAC;YAE3D,OAAO,UAAG,IAAI,CAAC,QAAQ,CAAC,aAAa,cAAI,IAAI,CAAC,aAAa,EAAE,cAAI,IAAI,CAAC,aAAa,EAAE,GAAG,EAAE,CAAC,CAAC,CAAC,GAAG,CAAC,CAAC,CAAC,EAAE,SAAG,IAAI,CAAC,aAAa,EAAE,CAAE,CAAC;QACnI,CAAC;QAED,kCAAS,GAAT,UAAU,IAAY,EAAE,IAAc;YAAd,qBAAA,EAAA,SAAc;YAClC,OAAO,CAAC,GAAG,CAAC,cAAc,GAAG,IAAI,EAAE,IAAI,CAAC,CAAC;YAEzC,MAAM,CAAC,MAAM,CAAC,WAAW,YACrB,IAAI,EAAE,IAAI,IACP,IAAI,GACR,GAAG,CAAC,CAAC;QACZ,CAAC;QACL,qBAAC;IAAD,CArlBA,AAqlBC,CArlBmC,gBAAM,CAAC,KAAK,GAqlB/C;IArlBY,wCAAc","file":"app-bundle.js","sourcesContent":["import { RouterConfiguration, Router } from 'aurelia-router';\n\nexport class App {\n    router: Router;\n\n    configureRouter(config: RouterConfiguration, router: Router): void {\n        this.router = router;\n\n        config.title = 'Cyberball';\n\n        config.map([\n            { route: ['', 'home'], name: 'home', moduleId: 'pages/home' },\n            { route: 'game', name: 'game', moduleId: 'pages/game' },\n            { route: 'message-test', name: 'message-test', moduleId: 'pages/message-test' }\n        ]);\n    }\n}\n","<template>\n    <router-view></router-view>\n</template>\n","export function getVariantValue(base: number, variance: number): number {\r\n    return base + (Phaser.Math.RND.between(0, variance) * Phaser.Math.RND.sign());\r\n}\r\n","export enum LeaveTrigger {\r\n    None = 0,\r\n    Turn = 1,\r\n    Time = 1 << 1,\r\n    Ignored = 1 << 2,\r\n    OtherLeaver = 1 << 3,\r\n    TimeIgnored = 1 << 4\r\n}\r\n","export default {\n  debug: true,\n  testing: true\n};\n","export function getCaughtBallPosition(player: Phaser.GameObjects.Sprite) {\n    return { x: player.x + (player.flipX ? -50 : 50), y: player.y - 15 };\n}\n\nexport function getActiveBallPosition(player: Phaser.GameObjects.Sprite) {\n    return { x: player.x + (player.flipX ? 40 : -40), y: player.y - 20 };\n}\n","import {Aurelia} from 'aurelia-framework'\nimport environment from './environment';\n\nexport function configure(aurelia: Aurelia) {\n  aurelia.use\n    .standardConfiguration()\n    .feature('resources');\n\n  aurelia.use.developmentLogging(environment.debug ? 'debug' : 'warn');\n\n  if (environment.testing) {\n    aurelia.use.plugin('aurelia-testing');\n  }\n\n  aurelia.start().then(() => aurelia.setRoot());\n}\n","export class BanterModel {\n    chance: number;\n    delay: number;\n    delayVariance: number;\n    messages: Array<string>;\n}\n","import { CyberballScene } from 'scenes/cyberball';\r\nimport { CpuSettingsModel } from './cpu-settings-model';\r\nimport { Player } from \"./player-model\";\r\n\r\n// TODO: WIP isolate game logic into more classes.\r\nexport class Cpu extends Player {\r\n    public settings: CpuSettingsModel;\r\n\r\n    constructor(settings: CpuSettingsModel, gameReference: CyberballScene) {\r\n        super(settings, gameReference);\r\n    }\r\n}\r\n","import { BanterModel } from './banter-model';\r\nimport { PlayerSettingsModel } from './player-settings-model';\r\n\r\nexport class CpuSettingsModel extends PlayerSettingsModel {\r\n    // A set of weights for each possible target, adding up to 100%.\r\n    targetPreference: Array<number> = [50, 50];\r\n\r\n    throwDelay: number = 500;\r\n    throwDelayVariance: number = 200;\r\n\r\n    catchDelay: number = 500;\r\n    catchDelayVariance: number = 200;\r\n\r\n    introductionBanter?: BanterModel;\r\n    throwBanter?: BanterModel\r\n    catchBanter?: BanterModel\r\n    leftOutBanter?: BanterModel\r\n\r\n    boredomBanterThreshold?: number;\r\n    boredomBanter?: BanterModel;\r\n\r\n    leaveTurnChance?: number = 100;\r\n    leaveTimeChance?: number = 100;\r\n    leaveIgnoredChance?: number = 100;\r\n    leaveTimeIgnoredChance?: number = 100;\r\n    leaveOtherLeaverChance?: number = 50;\r\n\r\n    constructor(init?: Partial<CpuSettingsModel>) {\r\n        super();\r\n\r\n        if(init)\r\n            Object.assign(this, init);\r\n    }\r\n}\r\n","import { getVariantValue } from './../behaviors/get-variant-value';\r\nimport { LeaveTrigger } from 'enums/leave-trigger';\r\nimport { CyberballScene } from './../scenes/cyberball';\r\nimport { PlayerSettingsModel } from './player-settings-model';\r\n\r\n// TODO: WIP isolate game logic into more classes.\r\nexport class Player {\r\n    public settings: PlayerSettingsModel;\r\n    protected gameReference: CyberballScene\r\n\r\n    // State\r\n    public hasBall: boolean = false;\r\n    public leaveTimeThreshold: number;\r\n    public leaveIgnoreTimeThreshold: number;\r\n\r\n    // Graphics\r\n    protected group: Phaser.Physics.Arcade.Group;\r\n    public sprite: Phaser.GameObjects.Sprite;\r\n    protected nameText: Phaser.GameObjects.Text;\r\n    protected portrait: Phaser.GameObjects.Image;\r\n\r\n    constructor(settings: PlayerSettingsModel, gameReference: CyberballScene) {\r\n        this.settings = settings;\r\n        this.gameReference = gameReference;\r\n    }\r\n\r\n    public create() {\r\n        // Graphics\r\n\r\n        let position = this.getPosition();\r\n\r\n        this.group = this.gameReference.physics.add.group({ immovable: true, allowGravity: false });\r\n\r\n        // TODO: Separate spritesheet and animation from game into separate class?\r\n        this.sprite = this.group.create(position.x, position.y, 'player', 'active/1.png');\r\n\r\n        if (this.settings.tint)\r\n            this.sprite.setTint(parseInt(this.settings.tint.substring(1), 16));\r\n\r\n        this.nameText = this.gameReference.add.text(\r\n            position.x,\r\n            position.y + this.sprite.height / 2 + 10,\r\n            this.settings.name,\r\n            { fontFamily: 'Arial', color: '#000000' }\r\n        ).setOrigin(0.5);\r\n\r\n        if (this.settings.portrait) {\r\n            let portraitPosition = this.getPortraitPosition();\r\n            // TODO: Load portrait in constructor?\r\n            this.portrait = this.gameReference.add.image(portraitPosition.x, portraitPosition.y, 'playerPortrait');\r\n        }\r\n\r\n        // Triggers\r\n\r\n        if ((this.settings.leaveTrigger & LeaveTrigger.Time) === LeaveTrigger.Time) {\r\n            this.leaveTimeThreshold = Date.now() + getVariantValue(this.settings.leaveTime, this.settings.leaveTimeVariance) * 1000;\r\n        }\r\n\r\n        if ((this.settings.leaveTrigger & LeaveTrigger.TimeIgnored) === LeaveTrigger.TimeIgnored) {\r\n            this.leaveIgnoreTimeThreshold = Date.now() + getVariantValue(this.settings.leaveTimeIgnored, this.settings.leaveTimeIgnoredVariance) * 1000;\r\n        }\r\n    }\r\n\r\n    // TODO: This feels gross.\r\n    protected getPosition(): Phaser.Geom.Point {\r\n        let padding = 75;\r\n\r\n        if(this.gameReference.settings.hasPortraits)\r\n            padding += this.gameReference.settings.portraitHeight + this.gameReference.settings.portraitPadding * 2;\r\n\r\n        return new Phaser.Geom.Point(\r\n            this.gameReference.sys.canvas.width / 2,\r\n            this.gameReference.sys.canvas.height - padding\r\n        );\r\n    }\r\n\r\n    protected getPortraitPosition(): Phaser.Geom.Point {\r\n        var position = this.getPosition();\r\n\r\n        return new Phaser.Geom.Point(\r\n            position.x,\r\n            position.y + this.gameReference.settings.portraitHeight / 2 + this.gameReference.settings.portraitPadding * 2 + this.sprite.height / 2 + 10\r\n        );\r\n    }\r\n}\r\n","import { LeaveTrigger } from \"enums/leave-trigger\";\r\n\r\nexport class PlayerSettingsModel {\r\n    name: string;\r\n    tint?: string;\r\n\r\n    portrait?: string;\r\n\r\n    /** Actions that may trigger a leave by this player. */\r\n    leaveTrigger?: LeaveTrigger = LeaveTrigger.None;\r\n\r\n    /** This player may leave after this many turns. */\r\n    leaveTurn?: number = 10;\r\n    leaveTurnVariance?: number = 2;\r\n\r\n    /** This player may leave after this much time. (Seconds) */\r\n    leaveTime?: number = 120;\r\n    leaveTimeVariance?: number = 30;\r\n\r\n    /** This player may leave after not catching the ball for this many turns. */\r\n    leaveIgnored?: number = 10;\r\n    leaveIgnoredVariance?: number = 2;\r\n\r\n    /** This player may leave after not catching the ball for this much time. (Seconds) */\r\n    leaveTimeIgnored?: number = 45;\r\n    leaveTimeIgnoredVariance?: number = 15;\r\n\r\n    /** This player may leave after this many other players leave. */\r\n    leaveOtherLeaver?: number = 2;\r\n\r\n    constructor(init?: Partial<PlayerSettingsModel>) {\r\n        if(init)\r\n            Object.assign(this, init);\r\n    }\r\n}\r\n","import { PlayerSettingsModel } from './player-settings-model';\r\nimport { CpuSettingsModel } from './cpu-settings-model';\r\n\r\nexport class SettingsModel {\r\n    player: PlayerSettingsModel = new PlayerSettingsModel();\r\n    computerPlayers: Array<CpuSettingsModel>;\r\n\r\n    // Gameplay\r\n    throwCount: number = 10;\r\n    timeLimit: number = 0;\r\n    displayTimeLimit: boolean = false;\r\n    timeLimitText: string = 'Time Limit:';\r\n    ballSpeed: number = 500;\r\n\r\n    useSchedule: boolean = false;\r\n    scheduleHonorsThrowCount: boolean = false;\r\n    schedule: Array<number> = [\r\n        1, 2, 0, 1, 2, 0, 1, 2, 0, 1, 2, 0\r\n    ];\r\n\r\n    // Graphics\r\n    baseUrl: string = './assets';\r\n\r\n    ballSprite: string = 'ball.png';\r\n    ballTint?: string;\r\n\r\n    portraitHeight: number = 75;\r\n    portraitPadding: number = 10;\r\n\r\n    get hasPortraits(): boolean | string {\r\n        return this.player.portrait || this.computerPlayers.some(cpu => cpu.portrait);\r\n    }\r\n\r\n    // Misc\r\n    chatEnabled: boolean = false;\r\n\r\n    gameOverText: string = \"Game Over\";\r\n    gameOverOpacity: number = 0.5;\r\n\r\n    constructor(init?: Partial<SettingsModel>) {\r\n        Object.assign(this, init);\r\n    }\r\n}\r\n\r\nexport const defaultSettings = new SettingsModel({\r\n    player: new PlayerSettingsModel({\r\n       name: 'Player 1'\r\n    }),\r\n    computerPlayers: [\r\n        new CpuSettingsModel({\r\n            name: 'Player 2'\r\n        }),\r\n        new CpuSettingsModel({\r\n            name: 'Player 3'\r\n        })\r\n    ]\r\n});\r\n","import { CyberballScene } from './../scenes/cyberball';\nimport { defaultSettings, SettingsModel } from './../models/settings-model';\nimport Phaser from 'phaser';\nimport { PhaserGameCustomElement } from 'resources/phaser-game/phaser-game';\n\n//     // TODO: Use events to talk to Qualtrics?\n//     //setTimeout(() => { window.dispatchEvent(new CustomEvent('complete', { detail: { test: 'test' } }))}, 1000)\n\n\nexport class GameViewModel {\n    settings: SettingsModel = defaultSettings;\n\n    // Game:\n\n    game: PhaserGameCustomElement;\n\n    gameWidth = 800;\n    gameHeight = 460;\n\n    gameConfig: Phaser.Types.Core.GameConfig;\n\n    activate(params) {\n        if('settings' in params) {\n            this.settings = new SettingsModel(JSON.parse(atob(params.settings)));\n        }\n\n        if('playerName' in params) {\n            this.settings.player.name = params.playerName;\n        }\n\n        if(this.settings.hasPortraits) {\n            this.gameHeight += this.settings.portraitHeight * 2 + this.settings.portraitPadding * 4;\n        }\n    }\n\n    bind() {\n        this.gameConfig  = {\n            type: Phaser.AUTO,\n            width: this.gameWidth,\n            height: this.gameHeight,\n            scene: new CyberballScene(this.settings),\n            physics: {\n                default: 'arcade'\n            }\n        };\n    }\n\n    // Chat:\n\n    chatMessage: string;\n    chatMessages: Array<{sender: string, text: string}> = [];\n\n    sendMessage() {\n        this.chatMessages.push({\n            sender: this.settings.player.name,\n            text: this.chatMessage\n        });\n\n        this.chatMessage = '';\n    }\n}\n","canvas {\n    max-width: 100%;\n}\n\n.chat-log {\n    border: 1px solid black;\n    border-bottom: 0;\n    height: 100px;\n    overflow-y: auto;\n}\n\n.chat-input {\n    display: flex;\n}\n\n.chat-input input {\n    flex: 1;\n}\n","<template>\n    <require from=\"./game.css\"></require>\n\n    <phaser-game config.bind=\"gameConfig\"></phaser-game>\n\n    <div if.bind=\"settings.chatEnabled\" class=\"chat\" css=\"width: ${gameWidth}px\">\n        <div class=\"chat-log\">\n            <div repeat.for=\"message of chatMessages\">\n                <strong>${message.sender}</strong>: <span>${message.text}</span>\n            </div>\n        </div>\n\n        <form class=\"chat-input\" submit.delegate=\"sendMessage()\">\n            <input value.bind=\"chatMessage\" />\n            <button type=\"submit\">Send</button>\n        </form>\n    </div>\n</template>\n","import {BindingSignaler} from 'aurelia-templating-resources';\r\nimport {autoinject} from 'aurelia-framework';\r\nimport { SettingsModel, defaultSettings } from \"models/settings-model\";\r\nimport { CpuSettingsModel } from 'models/cpu-settings-model';\r\nimport ClipboardJS from 'clipboard';\r\n\r\n@autoinject()\r\nexport class HomeViewModel {\r\n    settings: SettingsModel = defaultSettings;\r\n    clipboard: ClipboardJS;\r\n\r\n    constructor(private signaler: BindingSignaler) {}\r\n\r\n    bind() {\r\n        this.clipboard = new ClipboardJS('#copy');\r\n    }\r\n\r\n    unbind() {\r\n        this.clipboard.destroy();\r\n    }\r\n\r\n    addCPU() {\r\n        this.settings.computerPlayers.push(new CpuSettingsModel({\r\n            name: `Player ${this.settings.computerPlayers.length + 2}`\r\n        }));\r\n\r\n        this.settings.computerPlayers.forEach(cpu => {\r\n            while(cpu.targetPreference.length != this.settings.computerPlayers.length)\r\n                cpu.targetPreference.push(0);\r\n        });\r\n    }\r\n\r\n    removeCPU() {\r\n        this.settings.computerPlayers.pop();\r\n\r\n        this.settings.computerPlayers.forEach(cpu => {\r\n            cpu.targetPreference.pop();\r\n        });\r\n    }\r\n\r\n    saveSettings() {\r\n        this.signaler.signal('save-settings');\r\n    }\r\n\r\n    get url() {\r\n        let url = document.location.origin + document.location.pathname;\r\n\r\n        url += '#game?settings=';\r\n        url += btoa(JSON.stringify(this.settings));\r\n\r\n        return url;\r\n    }\r\n\r\n    testGame() {\r\n        window.open(this.url);\r\n    }\r\n}\r\n","<template>\r\n    <require from=\"resources/value-converters/json-value-converter\"></require>\r\n    <require from=\"resources/value-converters/integer-value-converter\"></require>\r\n    <require from=\"resources/value-converters/number-value-converter\"></require>\r\n    <require from=\"resources/value-converters/integer-array-value-converter\"></require>\r\n    <require from=\"resources/value-converters/flag-value-converter\"></require>\r\n\r\n    <style>\r\n        body {\r\n            background: #111;\r\n            color: #eee;\r\n            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;\r\n        }\r\n\r\n        .input {\r\n            display: flex;\r\n            margin-bottom: 5px;\r\n        }\r\n\r\n        .input label {\r\n            width: 180px;\r\n        }\r\n\r\n        .input label + * {\r\n            box-sizing: border-box;\r\n            max-width: 300px;\r\n        }\r\n\r\n        .input input[type=text], .input input[type=number], textarea {\r\n            flex: 1 1 100%;\r\n            min-width: 0;\r\n            width: auto;\r\n        }\r\n\r\n        .column {\r\n            display: flex;\r\n            flex-direction: column;\r\n        }\r\n\r\n        .input > div {\r\n            display: flex;\r\n        }\r\n\r\n        pre {\r\n            max-width: 100%;\r\n            overflow-x: auto;\r\n        }\r\n    </style>\r\n\r\n    <div style=\"display: flex;\">\r\n        <div style=\"margin-right: 20px;\">\r\n            <h1>Cyberball Configuration Builder</h1>\r\n\r\n            <h2>Player</h2>\r\n\r\n            <div class=\"input\">\r\n                <label>Name</label>\r\n                <input type=\"text\" value.bind=\"settings.player.name\" />\r\n            </div>\r\n\r\n            <div class=\"input\">\r\n                <label>Tint Color</label>\r\n                <input type=\"color\" value.bind=\"settings.player.tint\" />\r\n            </div>\r\n\r\n            <div class=\"input\">\r\n                <label>Portrait</label>\r\n                <input type=\"text\" value.bind=\"settings.player.portrait\" />\r\n            </div>\r\n\r\n            <div>Leave Triggers</div>\r\n            <div class=\"column\">\r\n                <label>\r\n                    <input type=\"checkbox\" checked.bind=\"settings.player.leaveTrigger | flag:settings.player.leaveTrigger:1\" /> Throws Elapsed\r\n                </label>\r\n                <label>\r\n                    <input type=\"checkbox\" checked.bind=\"settings.player.leaveTrigger | flag:settings.player.leaveTrigger:2\" /> Time Elapsed\r\n                </label>\r\n                <label>\r\n                    <input type=\"checkbox\" checked.bind=\"settings.player.leaveTrigger | flag:settings.player.leaveTrigger:4\" /> Throws Ignored\r\n                </label>\r\n                <label>\r\n                    <input type=\"checkbox\" checked.bind=\"settings.player.leaveTrigger | flag:settings.player.leaveTrigger:16\" /> Time Ignored\r\n                </label>\r\n                <label>\r\n                    <input type=\"checkbox\" checked.bind=\"settings.player.leaveTrigger | flag:settings.player.leaveTrigger:8\" /> Other Players Leaving\r\n                </label>\r\n            </div>\r\n\r\n            <div class=\"column\" if.bind=\"settings.player.leaveTrigger | flag:settings.player.leaveTrigger:1\">\r\n                <label>Throws Elapsed Leave Threshold/Variance</label>\r\n\r\n                <div>\r\n                    <input type=\"number\" value.bind=\"settings.player.leaveTurn | integer\" />\r\n                    <input type=\"number\" value.bind=\"settings.player.leaveTurnVariance | integer\" />\r\n                </div>\r\n            </div>\r\n\r\n            <div class=\"column\" if.bind=\"settings.player.leaveTrigger | flag:settings.player.leaveTrigger:2\">\r\n                <label>Time Elapsed Leave Threshold/Variance</label>\r\n\r\n                <div>\r\n                    <input type=\"number\" value.bind=\"settings.player.leaveTime | integer\" />\r\n                    <input type=\"number\" value.bind=\"settings.player.leaveTimeVariance | integer\" />\r\n                </div>\r\n            </div>\r\n\r\n            <div class=\"column\" if.bind=\"settings.player.leaveTrigger | flag:settings.player.leaveTrigger:4\">\r\n                <label>Ignored Throws Leave Threshold/Variance</label>\r\n\r\n                <div>\r\n                    <input type=\"number\" value.bind=\"settings.player.leaveIgnored | integer\" />\r\n                    <input type=\"number\" value.bind=\"settings.player.leaveIgnoredVariance | integer\" />\r\n                </div>\r\n            </div>\r\n\r\n            <div class=\"column\" if.bind=\"settings.player.leaveTrigger | flag:settings.player.leaveTrigger:16\">\r\n                <label>Ignored Time Leave Threshold/Variance</label>\r\n\r\n                <div>\r\n                    <input type=\"number\" value.bind=\"settings.player.leaveTimeIgnored | integer\" />\r\n                    <input type=\"number\" value.bind=\"settings.player.leaveTimeIgnoredVariance | integer\" />\r\n                </div>\r\n            </div>\r\n\r\n            <div class=\"column\" if.bind=\"settings.player.leaveTrigger | flag:settings.player.leaveTrigger:8\">\r\n                <label>Others Left Leave Threshold</label>\r\n\r\n                <div>\r\n                    <input type=\"number\" value.bind=\"settings.player.leaveOtherLeaver | integer\" />\r\n                </div>\r\n            </div>\r\n\r\n            <h2>\r\n                CPUs\r\n                <button click.delegate=\"addCPU()\">+ Add CPU</button>\r\n                <button click.delegate=\"removeCPU()\">- Remove CPU</button>\r\n            </h2>\r\n\r\n            <div repeat.for=\"cpu of settings.computerPlayers\">\r\n                <div class=\"input\">\r\n                    <label>Name</label>\r\n                    <input type=\"text\" value.bind=\"cpu.name\" />\r\n                </div>\r\n\r\n                <div class=\"input\">\r\n                    <label>Tint Color</label>\r\n                    <input type=\"color\" value.bind=\"cpu.tint\" />\r\n                </div>\r\n\r\n                <div class=\"input\">\r\n                    <label>Portrait</label>\r\n                    <input type=\"text\" value.bind=\"cpu.portrait\" />\r\n                </div>\r\n\r\n                <div class=\"input\">\r\n                    <label>Throw Delay</label>\r\n                    <input type=\"number\" value.bind=\"cpu.throwDelay | integer\" />\r\n                </div>\r\n\r\n                <div class=\"input\">\r\n                    <label>Throw Delay Variance</label>\r\n                    <input type=\"number\" value.bind=\"cpu.throwDelayVariance | integer\" />\r\n                </div>\r\n\r\n                <div class=\"input\">\r\n                    <label>Catch Delay</label>\r\n                    <input type=\"number\" value.bind=\"cpu.catchDelay | integer\" />\r\n                </div>\r\n\r\n                <div class=\"input\">\r\n                    <label>Catch Delay Variance</label>\r\n                    <input type=\"number\" value.bind=\"cpu.catchDelayVariance | integer\" />\r\n                </div>\r\n\r\n\r\n                <div class=\"input\">\r\n                    <label>Target Preference</label>\r\n\r\n                    <div>\r\n                        <input repeat.for=\"target of cpu.targetPreference\" type=\"number\" value.bind=\"cpu.targetPreference[$index] | integer\" />\r\n                    </div>\r\n                </div>\r\n\r\n                <div>Leave Triggers</div>\r\n                <div class=\"column\">\r\n                    <label>\r\n                        <input type=\"checkbox\" checked.bind=\"cpu.leaveTrigger | flag:cpu.leaveTrigger:1\" /> Throws Elapsed\r\n                    </label>\r\n                    <label>\r\n                        <input type=\"checkbox\" checked.bind=\"cpu.leaveTrigger | flag:cpu.leaveTrigger:2\" /> Time Elapsed\r\n                    </label>\r\n                    <label>\r\n                        <input type=\"checkbox\" checked.bind=\"cpu.leaveTrigger | flag:cpu.leaveTrigger:4\" /> Throws Ignored\r\n                    </label>\r\n                    <label>\r\n                        <input type=\"checkbox\" checked.bind=\"cpu.leaveTrigger | flag:cpu.leaveTrigger:16\" /> Time Ignored\r\n                    </label>\r\n                    <label>\r\n                        <input type=\"checkbox\" checked.bind=\"cpu.leaveTrigger | flag:cpu.leaveTrigger:8\" /> Other Players Leaving\r\n                    </label>\r\n                </div>\r\n\r\n                <div class=\"column\" if.bind=\"cpu.leaveTrigger | flag:cpu.leaveTrigger:1\">\r\n                    <label>Throws Elapsed Leave Threshold/Variance/Chance</label>\r\n\r\n                    <div>\r\n                        <input type=\"number\" value.bind=\"cpu.leaveTurn | integer\" />\r\n                        <input type=\"number\" value.bind=\"cpu.leaveTurnVariance | integer\" />\r\n                        <input type=\"number\" value.bind=\"cpu.leaveTurnChance | integer\" />\r\n                    </div>\r\n                </div>\r\n\r\n                <div class=\"column\" if.bind=\"cpu.leaveTrigger | flag:cpu.leaveTrigger:2\">\r\n                    <label>Time Elapsed Leave Threshold/Variance/Chance</label>\r\n\r\n                    <div>\r\n                        <input type=\"number\" value.bind=\"cpu.leaveTime | integer\" />\r\n                        <input type=\"number\" value.bind=\"cpu.leaveTimeVariance | integer\" />\r\n                        <input type=\"number\" value.bind=\"cpu.leaveTimeChance | integer\" />\r\n                    </div>\r\n                </div>\r\n\r\n                <div class=\"column\" if.bind=\"cpu.leaveTrigger | flag:cpu.leaveTrigger:4\">\r\n                    <label>Ignored Throws Leave Threshold/Variance/Chance</label>\r\n\r\n                    <div>\r\n                        <input type=\"number\" value.bind=\"cpu.leaveIgnored | integer\" />\r\n                        <input type=\"number\" value.bind=\"cpu.leaveIgnoredVariance | integer\" />\r\n                        <input type=\"number\" value.bind=\"cpu.leaveIgnoredChance | integer\" />\r\n                    </div>\r\n                </div>\r\n\r\n                <div class=\"column\" if.bind=\"cpu.leaveTrigger | flag:cpu.leaveTrigger:16\">\r\n                    <label>Ignored Time Leave Threshold/Variance/Chance</label>\r\n\r\n                    <div>\r\n                        <input type=\"number\" value.bind=\"cpu.leaveTimeIgnored | integer\" />\r\n                        <input type=\"number\" value.bind=\"cpu.leaveTimeIgnoredVariance | integer\" />\r\n                        <input type=\"number\" value.bind=\"cpu.leaveTimeIgnoredChance | integer\" />\r\n                    </div>\r\n                </div>\r\n\r\n                <div class=\"column\" if.bind=\"cpu.leaveTrigger | flag:cpu.leaveTrigger:8\">\r\n                    <label>Others Left Leave Threshold/Chance</label>\r\n\r\n                    <div>\r\n                        <input type=\"number\" value.bind=\"cpu.leaveOtherLeaver | integer\" />\r\n                        <input type=\"number\" value.bind=\"cpu.leaveOtherLeaverChance | integer\" />\r\n                    </div>\r\n                </div>\r\n\r\n                <hr />\r\n            </div>\r\n\r\n            <h2>Gameplay</h2>\r\n\r\n            <div class=\"input\">\r\n                <label>Throw Count</label>\r\n                <input type=\"number\" value.bind=\"settings.throwCount | integer\" />\r\n            </div>\r\n\r\n            <div class=\"input\">\r\n                <label>Time Limit</label>\r\n                <input type=\"number\" value.bind=\"settings.timeLimit | integer\" />\r\n            </div>\r\n\r\n            <div class=\"input\">\r\n                <label>Display Time Limit</label>\r\n                <input type=\"checkbox\" checked.bind=\"settings.displayTimeLimit\" />\r\n            </div>\r\n\r\n            <div class=\"input\">\r\n                <label>Time Limit Label</label>\r\n                <input type=\"text\" value.bind=\"settings.timeLimitText\" />\r\n            </div>\r\n\r\n            <div class=\"input\">\r\n                <label>Ball Speed</label>\r\n                <input type=\"number\" value.bind=\"settings.ballSpeed | integer\" />\r\n            </div>\r\n\r\n            <div class=\"input\">\r\n                <label>Ball Tint Color</label>\r\n                <input type=\"color\" value.bind=\"settings.ballTint\" />\r\n            </div>\r\n\r\n            <div class=\"input\">\r\n                <label>Portrait Height</label>\r\n                <input type=\"number\" value.bind=\"settings.portraitHeight | integer\" />\r\n            </div>\r\n\r\n            <div class=\"input\">\r\n                <label>Use Schedule</label>\r\n                <input type=\"checkbox\" checked.bind=\"settings.useSchedule\" />\r\n            </div>\r\n\r\n            <div class=\"input\" if.bind=\"settings.useSchedule\">\r\n                <label>Schedule</label>\r\n                <textarea value.bind=\"settings.schedule | integerArray & updateTrigger:'blur'\"></textarea>\r\n            </div>\r\n\r\n            <div class=\"input\">\r\n                <label>Schedule Honors Throw Count</label>\r\n                <input type=\"checkbox\" checked.bind=\"settings.scheduleHonorsThrowCount\" />\r\n            </div>\r\n\r\n            <div class=\"input\">\r\n                <label>Game Over Text</label>\r\n                <input type=\"text\" value.bind=\"settings.gameOverText\" />\r\n            </div>\r\n\r\n            <div class=\"input\">\r\n                <label>Game Over Opacity</label>\r\n                <input type=\"number\" min=\"0\" max=\"1\" step=\"0.1\" value.bind=\"settings.gameOverOpacity | number\" />\r\n            </div>\r\n\r\n            <button click.delegate=\"saveSettings()\">Save</button>\r\n        </div>\r\n\r\n        <div style=\"overflow-y: auto;\">\r\n            <pre>${settings | json & signal: 'save-settings'}</pre>\r\n        </div>\r\n    </div>\r\n\r\n    <div>\r\n        <h1>\r\n            Code\r\n            <button id=\"copy\" data-clipboard-target=\"#code\">&#10697; Copy</button>\r\n            <button click.delegate=\"testGame()\">&#129514; Test</button>\r\n        </h1>\r\n        <pre id=\"code\">&lt;iframe id=\"cyberball\" width=\"100%\" height=\"580\" src=\"${url}\"&gt;&lt;/iframe&gt;</pre>\r\n    </div>\r\n</template>\r\n","import {BindingSignaler} from 'aurelia-templating-resources';\nimport {autoinject} from 'aurelia-framework';\n\n@autoinject()\nexport class MessageTestViewModel {\n    messages: Array<any> = [];\n\n    constructor(private signaler: BindingSignaler) {}\n\n    bind() {\n        window.addEventListener('message', (e) => {\n            console.log('message', e.data);\n            this.messages.push(e.data);\n\n            this.signaler.signal('message');\n        });\n    }\n}\n","<template>\n    <require from=\"resources/value-converters/json-value-converter\"></require>\n\n    <iframe src=\"/#game\" width=\"800\" height=\"600\"></iframe>\n    <div style=\"border: 1px solid black; width: 800px; height: 200px; overflow-y: auto;\">\n        <div repeat.for=\"message of messages\">${message | json & signal: 'message'}</div>\n    </div>\n</template>\n","import { FrameworkConfiguration, PLATFORM } from 'aurelia-framework';\n\nexport function configure(config: FrameworkConfiguration) {\n    config.globalResources(PLATFORM.moduleName('./phaser-game/phaser-game'));\n}\n","import { customElement, bindable, autoinject, inlineView } from \"aurelia-framework\";\nimport Phaser from 'phaser';\n\n@customElement('phaser-game')\n@autoinject()\n@inlineView('<template></template>')\nexport class PhaserGameCustomElement {\n    @bindable config: Phaser.Types.Core.GameConfig;\n    @bindable game: Phaser.Game;\n\n    constructor(protected element: Element) {\n\n    }\n\n    bind() {\n        this.config.parent = this.element as HTMLElement;\n        this.game = new Phaser.Game(this.config);\n    }\n}\n","export class FlagValueConverter {\r\n    fromView(value, source, flag) {\r\n        return value ? source | flag : source & ~flag;\r\n    }\r\n\r\n    toView(_value, source, flag) {\r\n        return (source & flag) === flag;\r\n    }\r\n}\r\n","export class IntegerArrayValueConverter {\n    fromView(value: string) {\n        // Remove anything but numbers and commas.\n        value = value.replace(/[^0-9,]/g, '');\n\n        // Remove any trailing comma.\n        if(value[value.length - 1] == ',')\n            value = value.substr(0, value.length - 1);\n\n        return JSON.parse(`[${value}]`);\n    }\n\n    toView(value: Array<number>) {\n        return JSON.stringify(value).substr(1, value.length * 2 - 1);\n    }\n}\n","export class IntegerValueConverter {\r\n    fromView(value) {\r\n        return parseInt(value ?? '0');\r\n    }\r\n}\r\n","export class JsonValueConverter {\n    toView(value) {\n        return JSON.stringify(value, null, 2);\n    }\n}\n","export class NumberValueConverter {\r\n    fromView(value) {\r\n        return parseFloat(value ?? '0');\r\n    }\r\n}\r\n","import { Player } from './../models/player-model';\r\nimport { LeaveTrigger } from 'enums/leave-trigger';\r\nimport { SettingsModel } from './../models/settings-model';\r\nimport Phaser from 'phaser';\r\nimport { CpuSettingsModel } from 'models/cpu-settings-model';\r\n\r\nconst textStyle = { fontFamily: 'Arial', color: '#000000' };\r\n\r\n\r\nexport class CyberballScene extends Phaser.Scene {\r\n    public settings: SettingsModel;\r\n\r\n    // Game Objects:\r\n    private player: Player;\r\n\r\n    private ballSprite: Phaser.GameObjects.Sprite;\r\n    private playerSprite: Phaser.GameObjects.Sprite;\r\n    private playerGroup: Phaser.Physics.Arcade.Group;\r\n    private cpuSprites: Phaser.GameObjects.Sprite[] = [];\r\n    private timeLimitText: Phaser.GameObjects.Text;\r\n\r\n    // Gameplay Mechanics:\r\n\r\n    private playerHasBall = true;\r\n    private ballHeld = true;\r\n    private throwTarget: Phaser.GameObjects.Sprite;\r\n\r\n    private activeTimeout;\r\n\r\n    private absentPlayers: number[] = [];\r\n    private showPlayerLeave: boolean = false;\r\n\r\n    private gameEnded = false;\r\n\r\n    // Stats:\r\n\r\n    private throwCount = 0;\r\n    private scheduleIndex = 0;\r\n    private lastTime: number;\r\n    private startTime: number;\r\n\r\n    constructor(settings: SettingsModel) {\r\n        super({});\r\n\r\n        this.settings = settings;\r\n    }\r\n\r\n    public preload() {\r\n        this.load.crossOrigin = 'anonymous';\r\n\r\n        // TODO: Load from settings.\r\n        this.load.image('ball', `${this.settings.baseUrl}/${this.settings.ballSprite}`);\r\n        this.load.multiatlas('player', `${this.settings.baseUrl}/player.json`, 'assets');\r\n\r\n        if(this.settings.player.portrait)\r\n            this.load.image('playerPortrait', 'https://proxy.cors.sh/' + this.settings.player.portrait);\r\n\r\n        this.settings.computerPlayers.forEach((cpu, i) => {\r\n            if(cpu.portrait)\r\n                this.load.image('cpuPortrait' + i, 'https://proxy.cors.sh/' + cpu.portrait);\r\n        });\r\n    }\r\n\r\n    public create() {\r\n        this.cameras.main.setBackgroundColor('#ffffff');\r\n\r\n        // Animations:\r\n\r\n        this.anims.create({\r\n            key: 'active',\r\n            frames: this.anims.generateFrameNames('player', { start: 1, end: 1, prefix: 'active/', suffix: '.png' })\r\n        });\r\n\r\n        this.anims.create({\r\n            key: 'idle',\r\n            frames: this.anims.generateFrameNames('player', { start: 1, end: 1, prefix: 'idle/', suffix: '.png' })\r\n        });\r\n\r\n        this.anims.create({\r\n            key: 'throw',\r\n            frameRate: 12,\r\n            frames: this.anims.generateFrameNames('player', { start: 1, end: 3, prefix: 'throw/', suffix: '.png' })\r\n        });\r\n\r\n        this.anims.create({\r\n            key: 'catch',\r\n            frames: this.anims.generateFrameNames('player', { start: 1, end: 1, prefix: 'catch/', suffix: '.png' })\r\n        });\r\n\r\n        // Player:\r\n\r\n        let playerPosition = this.getPlayerPosition();\r\n\r\n        this.playerGroup = this.physics.add.group({ immovable: true, allowGravity: false });\r\n        this.playerSprite = this.playerGroup.create(playerPosition.x, playerPosition.y, 'player', 'active/1.png');\r\n        this.playerSprite.setData('settings', this.settings.player);\r\n\r\n        if(this.settings.player.tint)\r\n            this.playerSprite.setTint(parseInt(this.settings.player.tint.substr(1), 16));\r\n\r\n        this.playerSprite.setData('name-object', this.add.text(playerPosition.x, playerPosition.y + this.playerSprite.height / 2 + 10, this.settings.player.name, textStyle).setOrigin(0.5));\r\n\r\n        if(this.settings.player.portrait) {\r\n            var portraitPosition = this.getPlayerPortraitPosition(this.playerSprite);\r\n            var image = this.add.image(portraitPosition.x, portraitPosition.y, 'playerPortrait');\r\n\r\n            image.setScale(this.settings.portraitHeight / image.height);\r\n        }\r\n\r\n        if((this.settings.player.leaveTrigger & LeaveTrigger.Time) === LeaveTrigger.Time) {\r\n            this.playerSprite.setData('leaveTime', Date.now() + this.getVariantValue(this.settings.player.leaveTime, this.settings.player.leaveTimeVariance) * 1000);\r\n        }\r\n\r\n        if((this.settings.player.leaveTrigger & LeaveTrigger.TimeIgnored) === LeaveTrigger.TimeIgnored) {\r\n            this.playerSprite.setData('leaveTimeIgnored', Date.now() + this.getVariantValue(this.settings.player.leaveTimeIgnored, this.settings.player.leaveTimeIgnoredVariance) * 1000);\r\n        }\r\n\r\n        // CPU:\r\n\r\n        for (let i = 0; i < this.settings.computerPlayers.length; i++) {\r\n            let cpuPosition = this.getCPUPosition(i);\r\n            let cpuSprite: Phaser.GameObjects.Sprite = this.playerGroup.create(cpuPosition.x, cpuPosition.y, 'player', 'idle/1.png');\r\n\r\n            cpuSprite.setData('name-object', this.add.text(cpuPosition.x, cpuPosition.y + cpuSprite.height / 2 + 10, this.settings.computerPlayers[i].name, textStyle).setOrigin(0.5));\r\n\r\n            if(this.settings.computerPlayers[i].portrait) {\r\n                var portraitPosition = this.getCPUPortraitPosition(i, cpuSprite);\r\n                var image = this.add.image(portraitPosition.x, portraitPosition.y, 'cpuPortrait' + i);\r\n\r\n                image.setScale(this.settings.portraitHeight / image.height);\r\n            }\r\n\r\n            cpuSprite.flipX = cpuPosition.x > this.playerSprite.x;\r\n            cpuSprite.setData('settings', this.settings.computerPlayers[i]);\r\n\r\n            if(this.settings.computerPlayers[i].tint)\r\n                cpuSprite.setTint(parseInt(this.settings.computerPlayers[i].tint.substr(1), 16));\r\n\r\n            cpuSprite.setInteractive();\r\n            cpuSprite.on('pointerdown', (e) => {\r\n                if (this.playerHasBall) {\r\n                    // Ensure player and ball are facing the correct way on touch devices:\r\n                    this.playerSprite.flipX = this.input.x < this.playerSprite.x;\r\n\r\n                    let ballPosition = this.getActiveBallPosition(this.playerSprite);\r\n                    this.ballSprite.x = ballPosition.x;\r\n                    this.ballSprite.y = ballPosition.y;\r\n\r\n                    this.throwBall(this.playerSprite, cpuSprite);\r\n                }\r\n            });\r\n\r\n            if((this.settings.computerPlayers[i].leaveTrigger & LeaveTrigger.Time) === LeaveTrigger.Time) {\r\n                cpuSprite.setData('leaveTime', Date.now() + this.getVariantValue(this.settings.computerPlayers[i].leaveTime, this.settings.computerPlayers[i].leaveTimeVariance) * 1000);\r\n            }\r\n\r\n            if((this.settings.computerPlayers[i].leaveTrigger & LeaveTrigger.TimeIgnored) === LeaveTrigger.TimeIgnored) {\r\n                cpuSprite.setData('leaveTimeIgnored', Date.now() + this.getVariantValue(this.settings.computerPlayers[i].leaveTimeIgnored, this.settings.computerPlayers[i].leaveTimeIgnoredVariance) * 1000);\r\n            }\r\n\r\n            this.cpuSprites.push(cpuSprite);\r\n        }\r\n\r\n        // Ball:\r\n\r\n        let ballPosition = this.getActiveBallPosition(this.playerSprite);\r\n        this.ballSprite = this.physics.add.sprite(ballPosition.x, ballPosition.y, 'ball');\r\n\r\n        if(this.settings.ballTint)\r\n            this.ballSprite.setTint(parseInt(this.settings.ballTint.substr(1), 16));\r\n\r\n        this.physics.add.overlap(this.ballSprite, this.playerGroup, (_b, receiver) => {\r\n            if (!this.ballHeld && receiver === this.throwTarget)\r\n                this.catchBall(receiver as Phaser.GameObjects.Sprite);\r\n        });\r\n\r\n        // Time Limit:\r\n\r\n        this.startTime = Date.now();\r\n        this.lastTime = this.startTime;\r\n\r\n        if (this.settings.timeLimit > 0 && this.settings.displayTimeLimit) {\r\n            this.timeLimitText = this.add.text(this.sys.canvas.width - 10, 10, this.getTimeString(), textStyle);\r\n            this.timeLimitText.setOrigin(1, 0);\r\n        }\r\n    }\r\n\r\n    public update() {\r\n        if(this.gameEnded)\r\n            return;\r\n\r\n        if (this.playerHasBall) {\r\n            this.playerSprite.play('active');\r\n            this.playerSprite.flipX = this.input.x < this.playerSprite.x;\r\n\r\n            let ballPosition = this.getActiveBallPosition(this.playerSprite);\r\n            this.ballSprite.x = ballPosition.x;\r\n            this.ballSprite.y = ballPosition.y;\r\n        } else if (!this.ballHeld) {\r\n            // Eyes on the ball:\r\n            this.playerGroup.getChildren().forEach(c => {\r\n                let sprite = c as Phaser.GameObjects.Sprite;\r\n                if (sprite.frame.name.includes('idle'))\r\n                    sprite.flipX = this.ballSprite.x < sprite.x\r\n            });\r\n        }\r\n\r\n        // Player may leave after time has passed:\r\n        if(!this.showPlayerLeave && (this.settings.player.leaveTrigger & LeaveTrigger.Time) === LeaveTrigger.Time &&\r\n                Date.now() > this.playerSprite.getData('leaveTime')) {\r\n            this.showPlayerLeave = true;\r\n            this.postEvent('player-may-leave', {\r\n                reason: 'time elapsed'\r\n            });\r\n        }\r\n        // Player may leave after ignored for a time:\r\n        else if (!this.playerHasBall && !this.showPlayerLeave && (this.settings.player.leaveTrigger & LeaveTrigger.TimeIgnored) === LeaveTrigger.TimeIgnored &&\r\n                    Date.now() > this.playerSprite.getData('leaveTimeIgnored')) {\r\n            this.showPlayerLeave = true;\r\n            this.postEvent('player-may-leave', {\r\n                reason: 'time ignored'\r\n            });\r\n        }\r\n\r\n        this.cpuSprites.forEach(cpu => {\r\n            // CPU shouldn't leave if they:\r\n            //  - have the ball or are about to catch the ball\r\n            //  - have already left\r\n            if (cpu == this.throwTarget || cpu.getData('absent'))\r\n                return;\r\n\r\n            let settings = cpu.getData('settings') as CpuSettingsModel;\r\n\r\n            // CPU may leave after some time\r\n            if((settings.leaveTrigger & LeaveTrigger.Time) === LeaveTrigger.Time &&\r\n                    Date.now() > cpu.getData('leaveTime')) {\r\n                this.leaveGame(cpu, 'time elapsed');\r\n            }\r\n            // CPU may leave after ignored for a time:\r\n            else if ((settings.leaveTrigger & LeaveTrigger.TimeIgnored) === LeaveTrigger.TimeIgnored &&\r\n                    Date.now() > cpu.getData('leaveTimeIgnored')) {\r\n                this.leaveGame(cpu, 'time ignored');\r\n            }\r\n        });\r\n\r\n        // Time Limit:\r\n\r\n        if (this.settings.timeLimit > 0 && this.settings.displayTimeLimit)\r\n            this.timeLimitText.setText(this.getTimeString());\r\n\r\n        if (this.settings.timeLimit > 0 && Date.now() - this.startTime > this.settings.timeLimit) {\r\n            this.postEvent('global-time-limit');\r\n            this.gameOver();\r\n        }\r\n    }\r\n\r\n    public gameOver() {\r\n        if (this.gameEnded)\r\n            return;\r\n\r\n        this.gameEnded = true;\r\n\r\n        this.postEvent('game-end');\r\n\r\n        // Stop future throws:\r\n        clearTimeout(this.activeTimeout);\r\n        this.playerGroup.children.iterate(child => {\r\n            child.removeAllListeners();\r\n            return true;\r\n        });\r\n\r\n        // Draw game over screen:\r\n        this.add.rectangle(this.sys.canvas.width / 2, this.sys.canvas.height / 2, this.sys.canvas.width, this.sys.canvas.height, 0xdddddd, this.settings.gameOverOpacity);\r\n        this.add.text(this.sys.canvas.width / 2, this.sys.canvas.height / 2, this.settings.gameOverText, textStyle).setOrigin(0.5);\r\n    }\r\n\r\n    // Mechanics:\r\n\r\n    public throwBall(thrower: Phaser.GameObjects.Sprite, receiver: Phaser.GameObjects.Sprite) {\r\n        this.postEvent('throw', {\r\n            thrower: thrower.getData('settings').name,\r\n            receiver: receiver.getData('settings').name,\r\n            wait: Date.now() - this.lastTime\r\n        });\r\n\r\n        this.lastTime = Date.now();\r\n\r\n        // Update trackers:\r\n\r\n        // Wait until the player throws the ball to reset their ignored timer, so they cannot ignore themselves.\r\n        let throwerSettings = thrower.getData('settings');\r\n        // TODO: Bug\r\n        if((throwerSettings.leaveTrigger & LeaveTrigger.TimeIgnored) === LeaveTrigger.TimeIgnored) {\r\n            receiver.setData('leaveTimeIgnored', Date.now() + this.getVariantValue(throwerSettings.leaveTimeIgnored, throwerSettings.leaveTimeIgnoredVariance) * 1000);\r\n        }\r\n\r\n        this.playerHasBall = this.ballHeld = false;\r\n        this.throwTarget = receiver;\r\n\r\n        this.throwCount++;\r\n\r\n        // Player animation:\r\n\r\n        thrower.play('throw');\r\n        thrower.playAfterRepeat('idle');\r\n\r\n        // Ball physics:\r\n\r\n        let ballTargetPosition = this.getCaughtBallPosition(receiver);\r\n        this.physics.moveTo(this.ballSprite, ballTargetPosition.x, ballTargetPosition.y, this.settings.ballSpeed);\r\n    }\r\n\r\n    public catchBall(receiver: Phaser.GameObjects.Sprite) {\r\n        // Update trackers:\r\n\r\n        this.ballHeld = true;\r\n        receiver.setData('throwsIgnored', 0)\r\n\r\n        // Player animation:\r\n\r\n        receiver.play('catch');\r\n\r\n        // Ball physics:\r\n\r\n        let ballPosition = this.getCaughtBallPosition(receiver);\r\n        (this.ballSprite.body as Phaser.Physics.Arcade.Body).reset(ballPosition.x, ballPosition.y);\r\n\r\n        // Check for leavers:\r\n\r\n        // Player may leave after a number of turns:\r\n        if(!this.showPlayerLeave && (this.settings.player.leaveTrigger & LeaveTrigger.Turn) === LeaveTrigger.Turn) {\r\n            let leaveThrows = this.getVariantValue(this.settings.player.leaveTurn, this.settings.player.leaveTurnVariance);\r\n\r\n            if (this.throwCount >= leaveThrows) {\r\n                this.showPlayerLeave = true;\r\n                this.postEvent('player-may-leave', {\r\n                    reason: 'throws elapsed'\r\n                });\r\n            }\r\n        }\r\n        // Player may leave after ignored for a number of turns:\r\n        else if(!this.showPlayerLeave && (this.settings.player.leaveTrigger & LeaveTrigger.Ignored) === LeaveTrigger.Ignored) {\r\n            let leaveThrows = this.getVariantValue(this.settings.player.leaveIgnored, this.settings.player.leaveIgnoredVariance);\r\n            let playerThrowsIgnored = this.playerSprite.getData('throwsIgnored') ?? 0;\r\n\r\n            if(this.playerSprite != receiver)\r\n                this.playerSprite.setData('throwsIgnored', ++playerThrowsIgnored);\r\n\r\n            if (playerThrowsIgnored >= leaveThrows) {\r\n                this.showPlayerLeave = true;\r\n                this.postEvent('player-may-leave', {\r\n                    reason: 'throws ignored'\r\n                });\r\n            }\r\n        }\r\n\r\n        this.cpuSprites.forEach(cpu => {\r\n            // CPU shouldn't leave if they:\r\n            //  - have the ball\r\n            //  - have already left\r\n            if (cpu == receiver || cpu.getData('absent'))\r\n                return;\r\n\r\n            let settings = cpu.getData('settings') as CpuSettingsModel;\r\n            let throwsIgnored = (cpu.getData('throwsIgnored') ?? 0) + 1;\r\n            cpu.setData('throwsIgnored', throwsIgnored);\r\n\r\n            // CPU may leave after a number of turns:\r\n            if((settings.leaveTrigger & LeaveTrigger.Turn) === LeaveTrigger.Turn) {\r\n                let leaveThrows = this.getVariantValue(settings.leaveTurn, settings.leaveTurnVariance);\r\n\r\n                if (this.throwCount >= leaveThrows && this.checkChance(settings.leaveTurnChance))\r\n                    this.leaveGame(cpu, 'throws elapsed');\r\n            }\r\n            // CPU may leave after ignored for a number of turns:\r\n            else if((settings.leaveTrigger & LeaveTrigger.Ignored) === LeaveTrigger.Ignored) {\r\n                let leaveThrows = this.getVariantValue(settings.leaveIgnored, settings.leaveIgnoredVariance);\r\n\r\n                if (throwsIgnored >= leaveThrows && this.checkChance(settings.leaveIgnoredChance))\r\n                    this.leaveGame(cpu, 'throws ignored');\r\n            }\r\n        });\r\n\r\n        // The game ends at the end of the schedule or when reaching the throw count.\r\n\r\n        if (\r\n            (this.settings.useSchedule && this.scheduleIndex === this.settings.schedule.length) ||\r\n            (this.settings.useSchedule && this.settings.scheduleHonorsThrowCount && this.throwCount >= this.settings.throwCount) ||\r\n            (!this.settings.useSchedule && this.throwCount >= this.settings.throwCount)\r\n        ) {\r\n            this.postEvent('throw-count-met');\r\n            this.gameOver();\r\n            return;\r\n        }\r\n\r\n        // Prepare for next throw:\r\n\r\n        if (receiver === this.playerSprite) {\r\n            this.playerHasBall = true;\r\n        } else {\r\n            let settings = receiver.getData('settings') as CpuSettingsModel;\r\n\r\n            this.activeTimeout = setTimeout(() => {\r\n                receiver.play('active');\r\n\r\n                ballPosition = this.getActiveBallPosition(receiver);\r\n                this.ballSprite.x = ballPosition.x;\r\n                this.ballSprite.y = ballPosition.y;\r\n\r\n                this.activeTimeout = setTimeout(() => {\r\n                    if (this.settings.useSchedule) {\r\n                        // Skip self and absent players in schedule.\r\n                        while(this.settings.schedule[this.scheduleIndex] === this.playerGroup.getChildren().indexOf(receiver) &&\r\n                            !this.absentPlayers.includes(this.settings.schedule[this.scheduleIndex]))\r\n                            this.scheduleIndex++\r\n\r\n                        this.throwBall(receiver, this.playerGroup.getChildren()[this.settings.schedule[this.scheduleIndex]] as Phaser.GameObjects.Sprite)\r\n                        this.scheduleIndex++;\r\n                    } else {\r\n                        let random = Math.random() * 100;\r\n\r\n                        // A psuedo-random target is selected by subtracting the target preference chance from the random number until 0 is reached\r\n                        for (var i = 0; i < settings.targetPreference.length; i++) {\r\n                            random -= settings.targetPreference[i];\r\n\r\n                            if (random <= 0) {\r\n                                // Exclude self\r\n                                if (i >= this.playerGroup.getChildren().indexOf(receiver))\r\n                                    i++\r\n\r\n                                this.throwBall(receiver, this.playerGroup.getChildren()[i] as Phaser.GameObjects.Sprite);\r\n\r\n                                break;\r\n                            }\r\n                        }\r\n                    }\r\n                }, this.getVariantValue(settings.throwDelay, settings.throwDelayVariance));\r\n            }, this.getVariantValue(settings.catchDelay, settings.catchDelayVariance))\r\n        }\r\n    }\r\n\r\n    public leaveGame(player: Phaser.GameObjects.Sprite, reason: string = '') {\r\n        let nameObject = player.getData('name-object') as Phaser.GameObjects.Text;\r\n        let playerIndex = this.playerGroup.getChildren().indexOf(player);\r\n\r\n        this.absentPlayers.push(playerIndex);\r\n        player.setData('absent', true);\r\n\r\n        nameObject.setText([nameObject.text, 'has left the game.']);\r\n\r\n        // Deactivate player object\r\n\r\n        player.removeAllListeners();\r\n        player.setVisible(false);\r\n\r\n        this.postEvent('leave', {\r\n            leaver: player.getData('settings').name,\r\n            reason: reason\r\n        });\r\n\r\n        // Redistribute throw target weights:\r\n\r\n        console.log('pindex', playerIndex);\r\n\r\n        this.settings.computerPlayers.forEach((cpu, i) => {\r\n            if(this.absentPlayers.includes(i + 1))\r\n                return;\r\n\r\n            console.log('distribute before', i, cpu.targetPreference);\r\n\r\n            let targetIndex = playerIndex > (i + 1) ? playerIndex - 1 : playerIndex;\r\n            let targetWeight = cpu.targetPreference[targetIndex];\r\n            cpu.targetPreference[targetIndex] = 0;\r\n            let total = cpu.targetPreference.reduce((acc, cur) => acc + cur);\r\n\r\n            for(let k = 0; k < cpu.targetPreference.length; k++) {\r\n                if (cpu.targetPreference[k] == 0)\r\n                    continue;\r\n\r\n                cpu.targetPreference[k] += cpu.targetPreference[k] / total * targetWeight;\r\n            }\r\n\r\n            console.log('distribute after', i, cpu.targetPreference);\r\n        });\r\n\r\n        // If there is only one player left, end the game:\r\n        if (this.absentPlayers.length >= this.settings.computerPlayers.length) {\r\n            this.gameOver();\r\n            return;\r\n        }\r\n\r\n        // Check if this triggers other players leaving:\r\n\r\n        if(!this.showPlayerLeave && (this.settings.player.leaveTrigger & LeaveTrigger.OtherLeaver) === LeaveTrigger.OtherLeaver) {\r\n            console.log(this.absentPlayers.length, this.settings.player.leaveOtherLeaver);\r\n            if (this.absentPlayers.length >= this.settings.player.leaveOtherLeaver) {\r\n                this.showPlayerLeave = true;\r\n                this.postEvent('player-may-leave', {\r\n                    reason: 'other leavers'\r\n                });\r\n            }\r\n        }\r\n\r\n        this.cpuSprites.forEach(cpu => {\r\n            let settings = cpu.getData('settings') as CpuSettingsModel;\r\n\r\n            // CPU shouldn't leave if they:\r\n            //  - have the ball\r\n            //  - have already left\r\n            if (cpu == this.throwTarget || cpu.getData('absent'))\r\n                return;\r\n\r\n            if((settings.leaveTrigger & LeaveTrigger.OtherLeaver) === LeaveTrigger.OtherLeaver) {\r\n                if (this.absentPlayers.length >= settings.leaveOtherLeaver && this.checkChance(settings.leaveOtherLeaverChance))\r\n                    this.leaveGame(cpu, 'other leavers');\r\n            }\r\n        });\r\n    }\r\n\r\n    // Helpers:\r\n\r\n    getCPUPosition(i: number): Phaser.Geom.Point {\r\n        // TODO: Increase padding when portaits are enabled.\r\n        let padding = 75;\r\n        let extraPadding = this.settings.hasPortraits ? this.settings.portraitHeight + this.settings.portraitPadding * 2 : 0;\r\n\r\n        if(this.settings.computerPlayers.length === 1) {\r\n            return new Phaser.Geom.Point(\r\n                this.sys.canvas.width / 2,\r\n                padding + extraPadding\r\n            );\r\n        }\r\n\r\n        return new Phaser.Geom.Point(\r\n            // Evenly divide the width of the screen by the number of players.\r\n            ((this.sys.canvas.width - (padding * 2)) / (this.settings.computerPlayers.length - 1)) * i + padding,\r\n            // First and last player are closer in the middle, others stand along the edge.\r\n            i === 0 || i === this.settings.computerPlayers.length - 1\r\n                ? (this.sys.canvas.height / 2)\r\n                : padding + extraPadding\r\n        );\r\n    }\r\n\r\n    getCPUPortraitPosition(i: number, sprite: Phaser.GameObjects.Sprite): Phaser.Geom.Point  {\r\n        let position = this.getCPUPosition(i);\r\n\r\n        return new Phaser.Geom.Point(\r\n            position.x,\r\n            position.y - this.settings.portraitHeight + this.settings.portraitPadding * 2 - sprite.height / 2\r\n        );\r\n    }\r\n\r\n    getPlayerPosition(): Phaser.Geom.Point {\r\n        let padding = 75;\r\n\r\n        if(this.settings.hasPortraits)\r\n            padding += this.settings.portraitHeight + this.settings.portraitPadding * 2;\r\n\r\n        return new Phaser.Geom.Point(\r\n            this.sys.canvas.width / 2,\r\n            this.sys.canvas.height - padding\r\n        );\r\n    }\r\n\r\n    getPlayerPortraitPosition(sprite: Phaser.GameObjects.Sprite): Phaser.Geom.Point {\r\n        var position = this.getPlayerPosition();\r\n\r\n        return new Phaser.Geom.Point(\r\n            position.x,\r\n            position.y + this.settings.portraitHeight / 2 + this.settings.portraitPadding * 2 + sprite.height / 2 + 10\r\n        );\r\n    }\r\n\r\n    // TODO: This is invalid if the sprites are changed.\r\n    getCaughtBallPosition(target: Phaser.GameObjects.Sprite) {\r\n        return new Phaser.Geom.Point(target.x + (target.flipX ? -50 : 50), target.y - 15);\r\n    }\r\n\r\n    // TODO: This is invalid if the sprites are changed.\r\n    getActiveBallPosition(target: Phaser.GameObjects.Sprite) {\r\n        return new Phaser.Geom.Point(target.x + (target.flipX ? 40 : -40), target.y - 20);\r\n    }\r\n\r\n    getVariantValue(base: number, variance: number): number {\r\n        return base + (Phaser.Math.RND.between(0, variance) * Phaser.Math.RND.sign());\r\n    }\r\n\r\n    checkChance(chance: number): boolean {\r\n        return Phaser.Math.RND.between(0, 100) <= chance;\r\n    }\r\n\r\n    getTimeString(): string {\r\n        let timeRemaining = this.settings.timeLimit - (Date.now() - this.startTime);\r\n        let time = new Date(timeRemaining < 0 ? 0 : timeRemaining);\r\n\r\n        return `${this.settings.timeLimitText} ${time.getUTCMinutes()}:${time.getUTCSeconds() < 10 ? '0' : ''}${time.getUTCSeconds()}`;\r\n    }\r\n\r\n    postEvent(type: string, data: any = {}): void {\r\n        console.log('post event: ' + type, data);\r\n\r\n        window.parent.postMessage({\r\n            type: type,\r\n            ...data\r\n        }, '*');\r\n    }\r\n}\r\n"]}