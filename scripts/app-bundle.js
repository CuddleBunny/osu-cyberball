define("app",["require","exports"],(function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:true});t.App=void 0;var n=function(){function e(){}e.prototype.configureRouter=function(e,t){this.router=t;e.title="Cyberball";e.map([{route:["","home"],name:"home",moduleId:"pages/home"},{route:"game",name:"game",moduleId:"pages/game"},{route:"message-test",name:"message-test",moduleId:"pages/message-test"}])};return e}();t.App=n}));define("text!app.html",[],(function(){return"<template>\n    <router-view></router-view>\n</template>\n"}));define("enums/leave-trigger",["require","exports"],(function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:true});t.LeaveTrigger=void 0;var n;(function(e){e[e["None"]=0]="None";e[e["Turn"]=1]="Turn";e[e["Time"]=2]="Time";e[e["Ignored"]=4]="Ignored";e[e["OtherLeaver"]=8]="OtherLeaver";e[e["TimeIgnored"]=16]="TimeIgnored"})(n=t.LeaveTrigger||(t.LeaveTrigger={}))}));define("environment",["require","exports"],(function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:true});t.default={debug:false,testing:false}}));define("helpers",["require","exports"],(function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:true});t.getActiveBallPosition=t.getCaughtBallPosition=void 0;function n(e){return{x:e.x+(e.flipX?-50:50),y:e.y-15}}t.getCaughtBallPosition=n;function r(e){return{x:e.x+(e.flipX?40:-40),y:e.y-20}}t.getActiveBallPosition=r}));var __importDefault=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};define("main",["require","exports","./environment"],(function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:true});t.configure=void 0;n=__importDefault(n);function r(e){e.use.standardConfiguration().feature("resources");e.use.developmentLogging(n.default.debug?"debug":"warn");if(n.default.testing){e.use.plugin("aurelia-testing")}e.start().then((function(){return e.setRoot()}))}t.configure=r}));define("models/banter-model",["require","exports"],(function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:true});t.BanterModel=void 0;var n=function(){function e(){}return e}();t.BanterModel=n}));var __extends=this&&this.__extends||function(){var e=function(t,n){e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)if(Object.prototype.hasOwnProperty.call(t,n))e[n]=t[n]};return e(t,n)};return function(t,n){if(typeof n!=="function"&&n!==null)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");e(t,n);function r(){this.constructor=t}t.prototype=n===null?Object.create(n):(r.prototype=n.prototype,new r)}}();define("models/cpu-model",["require","exports","./player-model"],(function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:true});t.CPUModel=void 0;var r=function(e){__extends(t,e);function t(t){var n=e.call(this)||this;n.targetPreference=[50,50];n.throwDelay=500;n.throwDelayVariance=200;n.catchDelay=500;n.catchDelayVariance=200;n.leaveTurnChance=100;n.leaveTimeChance=100;n.leaveIgnoredChance=100;n.leaveTimeIgnoredChance=100;n.leaveOtherLeaverChance=50;if(t)Object.assign(n,t);return n}return t}(n.PlayerModel);t.CPUModel=r}));define("models/player-model",["require","exports","enums/leave-trigger"],(function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:true});t.PlayerModel=void 0;var r=function(){function e(e){this.leaveTrigger=n.LeaveTrigger.None;this.leaveTurn=10;this.leaveTurnVariance=2;this.leaveTime=120;this.leaveTimeVariance=30;this.leaveIgnored=10;this.leaveIgnoredVariance=2;this.leaveTimeIgnored=45;this.leaveTimeIgnoredVariance=15;this.leaveOtherLeaver=2;if(e)Object.assign(this,e)}return e}();t.PlayerModel=r}));define("models/settings-model",["require","exports","./player-model","./cpu-model"],(function(e,t,n,r){"use strict";Object.defineProperty(t,"__esModule",{value:true});t.defaultSettings=t.SettingsModel=void 0;var i=function(){function e(e){this.player=new n.PlayerModel;this.throwCount=10;this.ballSpeed=500;this.useSchedule=false;this.scheduleHonorsThrowCount=false;this.schedule=[1,2,0,1,2,0,1,2,0,1,2,0];this.baseUrl="./assets";this.ballSprite="ball.png";this.portraitHeight=75;this.portraitPadding=10;this.chatEnabled=false;this.gameOverText="Game Over";Object.assign(this,e)}Object.defineProperty(e.prototype,"hasPortraits",{get:function(){return this.player.portrait||this.computerPlayers.some((function(e){return e.portrait}))},enumerable:false,configurable:true});return e}();t.SettingsModel=i;t.defaultSettings=new i({player:new n.PlayerModel({name:"Player 1"}),computerPlayers:[new r.CPUModel({name:"Player 2"}),new r.CPUModel({name:"Player 3"})]})}));var __importDefault=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};define("pages/game",["require","exports","./../scenes/cyberball","./../models/settings-model","phaser"],(function(e,t,n,r,i){"use strict";Object.defineProperty(t,"__esModule",{value:true});t.GameViewModel=void 0;i=__importDefault(i);var a=function(){function e(){this.settings=r.defaultSettings;this.gameWidth=800;this.gameHeight=460;this.chatMessages=[]}e.prototype.activate=function(e){if("settings"in e){this.settings=new r.SettingsModel(JSON.parse(atob(e.settings)))}if("playerName"in e){this.settings.player.name=e.playerName}if(this.settings.hasPortraits){this.gameHeight+=this.settings.portraitHeight*2+this.settings.portraitPadding*4}};e.prototype.bind=function(){this.gameConfig={type:i.default.AUTO,width:this.gameWidth,height:this.gameHeight,scene:new n.CyberballScene(this.settings),physics:{default:"arcade"}}};e.prototype.sendMessage=function(){this.chatMessages.push({sender:this.settings.player.name,text:this.chatMessage});this.chatMessage=""};return e}();t.GameViewModel=a}));define("text!pages/game.css",[],(function(){return"canvas {\n    max-width: 100%;\n}\n\n.chat-log {\n    border: 1px solid black;\n    border-bottom: 0;\n    height: 100px;\n    overflow-y: auto;\n}\n\n.chat-input {\n    display: flex;\n}\n\n.chat-input input {\n    flex: 1;\n}\n"}));define("text!pages/game.html",[],(function(){return'<template>\n    <require from="./game.css"></require>\n\n    <phaser-game config.bind="gameConfig"></phaser-game>\n\n    <div if.bind="settings.chatEnabled" class="chat" css="width: ${gameWidth}px">\n        <div class="chat-log">\n            <div repeat.for="message of chatMessages">\n                <strong>${message.sender}</strong>: <span>${message.text}</span>\n            </div>\n        </div>\n\n        <form class="chat-input" submit.delegate="sendMessage()">\n            <input value.bind="chatMessage" />\n            <button type="submit">Send</button>\n        </form>\n    </div>\n</template>\n'}));var __decorate=this&&this.__decorate||function(e,t,n,r){var i=arguments.length,a=i<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,n):r,s;if(typeof Reflect==="object"&&typeof Reflect.decorate==="function")a=Reflect.decorate(e,t,n,r);else for(var l=e.length-1;l>=0;l--)if(s=e[l])a=(i<3?s(a):i>3?s(t,n,a):s(t,n))||a;return i>3&&a&&Object.defineProperty(t,n,a),a};var __metadata=this&&this.__metadata||function(e,t){if(typeof Reflect==="object"&&typeof Reflect.metadata==="function")return Reflect.metadata(e,t)};var __importDefault=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};define("pages/home",["require","exports","aurelia-templating-resources","aurelia-framework","models/settings-model","models/cpu-model","clipboard"],(function(e,t,n,r,i,a,s){"use strict";Object.defineProperty(t,"__esModule",{value:true});t.HomeViewModel=void 0;s=__importDefault(s);var l=function(){function e(e){this.signaler=e;this.settings=i.defaultSettings}e.prototype.bind=function(){this.clipboard=new s.default("#copy")};e.prototype.unbind=function(){this.clipboard.destroy()};e.prototype.addCPU=function(){var e=this;this.settings.computerPlayers.push(new a.CPUModel({name:"Player ".concat(this.settings.computerPlayers.length+2)}));this.settings.computerPlayers.forEach((function(t){while(t.targetPreference.length!=e.settings.computerPlayers.length)t.targetPreference.push(0)}))};e.prototype.removeCPU=function(){this.settings.computerPlayers.pop();this.settings.computerPlayers.forEach((function(e){e.targetPreference.pop()}))};e.prototype.saveSettings=function(){this.signaler.signal("save-settings")};Object.defineProperty(e.prototype,"url",{get:function(){var e=document.location.origin+document.location.pathname;e+="#game?settings=";e+=btoa(JSON.stringify(this.settings));return e},enumerable:false,configurable:true});e.prototype.testGame=function(){window.open(this.url)};e=__decorate([(0,r.autoinject)(),__metadata("design:paramtypes",[n.BindingSignaler])],e);return e}();t.HomeViewModel=l}));define("text!pages/home.html",[],(function(){return'<template>\n    <require from="resources/value-converters/json-value-converter"></require>\n    <require from="resources/value-converters/integer-value-converter"></require>\n    <require from="resources/value-converters/integer-array-value-converter"></require>\n    <require from="resources/value-converters/flag-value-converter"></require>\n\n    <style>\n        body {\n            background: #111;\n            color: #eee;\n            font-family: \'Segoe UI\', Tahoma, Geneva, Verdana, sans-serif;\n        }\n\n        .input {\n            display: flex;\n            margin-bottom: 5px;\n        }\n\n        .input label {\n            width: 180px;\n        }\n\n        .input label + * {\n            box-sizing: border-box;\n            max-width: 300px;\n        }\n\n        .input input[type=text], .input input[type=number], textarea {\n            flex: 1 1 100%;\n            min-width: 0;\n            width: auto;\n        }\n\n        .column {\n            display: flex;\n            flex-direction: column;\n        }\n\n        .input > div {\n            display: flex;\n        }\n\n        pre {\n            max-width: 100%;\n            overflow-x: auto;\n        }\n    </style>\n\n    <div style="display: flex;">\n        <div style="margin-right: 20px;">\n            <h1>Cyberball Configuration Builder</h1>\n\n            <h2>Player</h2>\n\n            <div class="input">\n                <label>Name</label>\n                <input type="text" value.bind="settings.player.name" />\n            </div>\n\n            <div class="input">\n                <label>Tint Color</label>\n                <input type="color" value.bind="settings.player.tint" />\n            </div>\n\n            <div class="input">\n                <label>Portrait</label>\n                <input type="text" value.bind="settings.player.portrait" />\n            </div>\n\n            <div>Leave Triggers</div>\n            <div class="column">\n                <label>\n                    <input type="checkbox" checked.bind="settings.player.leaveTrigger | flag:settings.player.leaveTrigger:1" /> Throws Elapsed\n                </label>\n                <label>\n                    <input type="checkbox" checked.bind="settings.player.leaveTrigger | flag:settings.player.leaveTrigger:2" /> Time Elapsed\n                </label>\n                <label>\n                    <input type="checkbox" checked.bind="settings.player.leaveTrigger | flag:settings.player.leaveTrigger:4" /> Throws Ignored\n                </label>\n                <label>\n                    <input type="checkbox" checked.bind="settings.player.leaveTrigger | flag:settings.player.leaveTrigger:16" /> Time Ignored\n                </label>\n                <label>\n                    <input type="checkbox" checked.bind="settings.player.leaveTrigger | flag:settings.player.leaveTrigger:8" /> Other Players Leaving\n                </label>\n            </div>\n\n            <div class="column" if.bind="settings.player.leaveTrigger | flag:settings.player.leaveTrigger:1">\n                <label>Throws Elapsed Leave Threshold/Variance</label>\n\n                <div>\n                    <input type="number" value.bind="settings.player.leaveTurn | integer" />\n                    <input type="number" value.bind="settings.player.leaveTurnVariance | integer" />\n                </div>\n            </div>\n\n            <div class="column" if.bind="settings.player.leaveTrigger | flag:settings.player.leaveTrigger:2">\n                <label>Time Elapsed Leave Threshold/Variance</label>\n\n                <div>\n                    <input type="number" value.bind="settings.player.leaveTime | integer" />\n                    <input type="number" value.bind="settings.player.leaveTimeVariance | integer" />\n                </div>\n            </div>\n\n            <div class="column" if.bind="settings.player.leaveTrigger | flag:settings.player.leaveTrigger:4">\n                <label>Ignored Throws Leave Threshold/Variance</label>\n\n                <div>\n                    <input type="number" value.bind="settings.player.leaveIgnored | integer" />\n                    <input type="number" value.bind="settings.player.leaveIgnoredVariance | integer" />\n                </div>\n            </div>\n\n            <div class="column" if.bind="settings.player.leaveTrigger | flag:settings.player.leaveTrigger:16">\n                <label>Ignored Time Leave Threshold/Variance</label>\n\n                <div>\n                    <input type="number" value.bind="settings.player.leaveTimeIgnored | integer" />\n                    <input type="number" value.bind="settings.player.leaveTimeIgnoredVariance | integer" />\n                </div>\n            </div>\n\n            <div class="column" if.bind="settings.player.leaveTrigger | flag:settings.player.leaveTrigger:8">\n                <label>Others Left Leave Threshold</label>\n\n                <div>\n                    <input type="number" value.bind="settings.player.leaveOtherLeaver | integer" />\n                </div>\n            </div>\n\n            <h2>\n                CPUs\n                <button click.delegate="addCPU()">+ Add CPU</button>\n                <button click.delegate="removeCPU()">- Remove CPU</button>\n            </h2>\n\n            <div repeat.for="cpu of settings.computerPlayers">\n                <div class="input">\n                    <label>Name</label>\n                    <input type="text" value.bind="cpu.name" />\n                </div>\n\n                <div class="input">\n                    <label>Tint Color</label>\n                    <input type="color" value.bind="cpu.tint" />\n                </div>\n\n                <div class="input">\n                    <label>Portrait</label>\n                    <input type="text" value.bind="cpu.portrait" />\n                </div>\n\n                <div class="input">\n                    <label>Throw Delay</label>\n                    <input type="number" value.bind="cpu.throwDelay | integer" />\n                </div>\n\n                <div class="input">\n                    <label>Throw Delay Variance</label>\n                    <input type="number" value.bind="cpu.throwDelayVariance | integer" />\n                </div>\n\n                <div class="input">\n                    <label>Catch Delay</label>\n                    <input type="number" value.bind="cpu.catchDelay | integer" />\n                </div>\n\n                <div class="input">\n                    <label>Catch Delay Variance</label>\n                    <input type="number" value.bind="cpu.catchDelayVariance | integer" />\n                </div>\n\n\n                <div class="input">\n                    <label>Target Preference</label>\n\n                    <div>\n                        <input repeat.for="target of cpu.targetPreference" type="number" value.bind="cpu.targetPreference[$index] | integer" />\n                    </div>\n                </div>\n\n                <div>Leave Triggers</div>\n                <div class="column">\n                    <label>\n                        <input type="checkbox" checked.bind="cpu.leaveTrigger | flag:cpu.leaveTrigger:1" /> Throws Elapsed\n                    </label>\n                    <label>\n                        <input type="checkbox" checked.bind="cpu.leaveTrigger | flag:cpu.leaveTrigger:2" /> Time Elapsed\n                    </label>\n                    <label>\n                        <input type="checkbox" checked.bind="cpu.leaveTrigger | flag:cpu.leaveTrigger:4" /> Throws Ignored\n                    </label>\n                    <label>\n                        <input type="checkbox" checked.bind="cpu.leaveTrigger | flag:cpu.leaveTrigger:16" /> Time Ignored\n                    </label>\n                    <label>\n                        <input type="checkbox" checked.bind="cpu.leaveTrigger | flag:cpu.leaveTrigger:8" /> Other Players Leaving\n                    </label>\n                </div>\n\n                <div class="column" if.bind="cpu.leaveTrigger | flag:cpu.leaveTrigger:1">\n                    <label>Throws Elapsed Leave Threshold/Variance/Chance</label>\n\n                    <div>\n                        <input type="number" value.bind="cpu.leaveTurn | integer" />\n                        <input type="number" value.bind="cpu.leaveTurnVariance | integer" />\n                        <input type="number" value.bind="cpu.leaveTurnChance | integer" />\n                    </div>\n                </div>\n\n                <div class="column" if.bind="cpu.leaveTrigger | flag:cpu.leaveTrigger:2">\n                    <label>Time Elapsed Leave Threshold/Variance/Chance</label>\n\n                    <div>\n                        <input type="number" value.bind="cpu.leaveTime | integer" />\n                        <input type="number" value.bind="cpu.leaveTimeVariance | integer" />\n                        <input type="number" value.bind="cpu.leaveTimeChance | integer" />\n                    </div>\n                </div>\n\n                <div class="column" if.bind="cpu.leaveTrigger | flag:cpu.leaveTrigger:4">\n                    <label>Ignored Throws Leave Threshold/Variance/Chance</label>\n\n                    <div>\n                        <input type="number" value.bind="cpu.leaveIgnored | integer" />\n                        <input type="number" value.bind="cpu.leaveIgnoredVariance | integer" />\n                        <input type="number" value.bind="cpu.leaveIgnoredChance | integer" />\n                    </div>\n                </div>\n\n                <div class="column" if.bind="cpu.leaveTrigger | flag:cpu.leaveTrigger:16">\n                    <label>Ignored Time Leave Threshold/Variance/Chance</label>\n\n                    <div>\n                        <input type="number" value.bind="cpu.leaveTimeIgnored | integer" />\n                        <input type="number" value.bind="cpu.leaveTimeIgnoredVariance | integer" />\n                        <input type="number" value.bind="cpu.leaveTimeIgnoredChance | integer" />\n                    </div>\n                </div>\n\n                <div class="column" if.bind="cpu.leaveTrigger | flag:cpu.leaveTrigger:8">\n                    <label>Others Left Leave Threshold/Chance</label>\n\n                    <div>\n                        <input type="number" value.bind="cpu.leaveOtherLeaver | integer" />\n                        <input type="number" value.bind="cpu.leaveOtherLeaverChance | integer" />\n                    </div>\n                </div>\n\n                <hr />\n            </div>\n\n            <h2>Gameplay</h2>\n\n            <div class="input">\n                <label>Throw Count</label>\n                <input type="number" value.bind="settings.throwCount | integer" />\n            </div>\n\n            <div class="input">\n                <label>Ball Speed</label>\n                <input type="number" value.bind="settings.ballSpeed | integer" />\n            </div>\n\n            <div class="input">\n                <label>Ball Tint Color</label>\n                <input type="color" value.bind="settings.ballTint" />\n            </div>\n\n            <div class="input">\n                <label>Portrait Height</label>\n                <input type="number" value.bind="settings.portraitHeight | integer" />\n            </div>\n\n            <div class="input">\n                <label>Use Schedule</label>\n                <input type="checkbox" checked.bind="settings.useSchedule" />\n            </div>\n\n            <div class="input" if.bind="settings.useSchedule">\n                <label>Schedule</label>\n                <textarea value.bind="settings.schedule | integerArray & updateTrigger:\'blur\'"></textarea>\n            </div>\n\n            <div class="input">\n                <label>Schedule Honors Throw Count</label>\n                <input type="checkbox" checked.bind="settings.scheduleHonorsThrowCount" />\n            </div>\n\n            <div class="input">\n                <label>Game Over Text</label>\n                <input type="text" value.bind="settings.gameOverText" />\n            </div>\n\n            <button click.delegate="saveSettings()">Save</button>\n        </div>\n\n        <div style="overflow-y: auto;">\n            <pre>${settings | json & signal: \'save-settings\'}</pre>\n        </div>\n    </div>\n\n    <div>\n        <h1>\n            Code\n            <button id="copy" data-clipboard-target="#code">&#10697; Copy</button>\n            <button click.delegate="testGame()">&#129514; Test</button>\n        </h1>\n        <pre id="code">&lt;iframe id="cyberball" width="100%" height="580" src="${url}"&gt;&lt;/iframe&gt;</pre>\n    </div>\n</template>\n'}));var __decorate=this&&this.__decorate||function(e,t,n,r){var i=arguments.length,a=i<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,n):r,s;if(typeof Reflect==="object"&&typeof Reflect.decorate==="function")a=Reflect.decorate(e,t,n,r);else for(var l=e.length-1;l>=0;l--)if(s=e[l])a=(i<3?s(a):i>3?s(t,n,a):s(t,n))||a;return i>3&&a&&Object.defineProperty(t,n,a),a};var __metadata=this&&this.__metadata||function(e,t){if(typeof Reflect==="object"&&typeof Reflect.metadata==="function")return Reflect.metadata(e,t)};define("pages/message-test",["require","exports","aurelia-templating-resources","aurelia-framework"],(function(e,t,n,r){"use strict";Object.defineProperty(t,"__esModule",{value:true});t.MessageTestViewModel=void 0;var i=function(){function e(e){this.signaler=e;this.messages=[]}e.prototype.bind=function(){var e=this;window.addEventListener("message",(function(t){console.log("message",t.data);e.messages.push(t.data);e.signaler.signal("message")}))};e=__decorate([(0,r.autoinject)(),__metadata("design:paramtypes",[n.BindingSignaler])],e);return e}();t.MessageTestViewModel=i}));define("text!pages/message-test.html",[],(function(){return'<template>\n    <require from="resources/value-converters/json-value-converter"></require>\n\n    <iframe src="/#game" width="800" height="600"></iframe>\n    <div style="border: 1px solid black; width: 800px; height: 200px; overflow-y: auto;">\n        <div repeat.for="message of messages">${message | json & signal: \'message\'}</div>\n    </div>\n</template>\n'}));define("resources/index",["require","exports","aurelia-framework"],(function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:true});t.configure=void 0;function r(e){e.globalResources(n.PLATFORM.moduleName("./phaser-game/phaser-game"))}t.configure=r}));var __decorate=this&&this.__decorate||function(e,t,n,r){var i=arguments.length,a=i<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,n):r,s;if(typeof Reflect==="object"&&typeof Reflect.decorate==="function")a=Reflect.decorate(e,t,n,r);else for(var l=e.length-1;l>=0;l--)if(s=e[l])a=(i<3?s(a):i>3?s(t,n,a):s(t,n))||a;return i>3&&a&&Object.defineProperty(t,n,a),a};var __metadata=this&&this.__metadata||function(e,t){if(typeof Reflect==="object"&&typeof Reflect.metadata==="function")return Reflect.metadata(e,t)};var __importDefault=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};define("resources/phaser-game/phaser-game",["require","exports","aurelia-framework","phaser"],(function(e,t,n,r){"use strict";Object.defineProperty(t,"__esModule",{value:true});t.PhaserGameCustomElement=void 0;r=__importDefault(r);var i=function(){function e(e){this.element=e}e.prototype.bind=function(){this.config.parent=this.element;this.game=new r.default.Game(this.config)};__decorate([n.bindable,__metadata("design:type",Object)],e.prototype,"config",void 0);__decorate([n.bindable,__metadata("design:type",r.default.Game)],e.prototype,"game",void 0);e=__decorate([(0,n.customElement)("phaser-game"),(0,n.autoinject)(),(0,n.inlineView)("<template></template>"),__metadata("design:paramtypes",[Element])],e);return e}();t.PhaserGameCustomElement=i}));define("resources/value-converters/flag-value-converter",["require","exports"],(function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:true});t.FlagValueConverter=void 0;var n=function(){function e(){}e.prototype.fromView=function(e,t,n){return e?t|n:t&~n};e.prototype.toView=function(e,t,n){return(t&n)===n};return e}();t.FlagValueConverter=n}));define("resources/value-converters/integer-array-value-converter",["require","exports"],(function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:true});t.IntegerArrayValueConverter=void 0;var n=function(){function e(){}e.prototype.fromView=function(e){e=e.replace(/[^0-9,]/g,"");if(e[e.length-1]==",")e=e.substr(0,e.length-1);return JSON.parse("[".concat(e,"]"))};e.prototype.toView=function(e){return JSON.stringify(e).substr(1,e.length*2-1)};return e}();t.IntegerArrayValueConverter=n}));define("resources/value-converters/integer-value-converter",["require","exports"],(function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:true});t.IntegerValueConverter=void 0;var n=function(){function e(){}e.prototype.fromView=function(e){return parseInt(e)};return e}();t.IntegerValueConverter=n}));define("resources/value-converters/json-value-converter",["require","exports"],(function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:true});t.JsonValueConverter=void 0;var n=function(){function e(){}e.prototype.toView=function(e){return JSON.stringify(e,null,2)};return e}();t.JsonValueConverter=n}));var __extends=this&&this.__extends||function(){var e=function(t,n){e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)if(Object.prototype.hasOwnProperty.call(t,n))e[n]=t[n]};return e(t,n)};return function(t,n){if(typeof n!=="function"&&n!==null)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");e(t,n);function r(){this.constructor=t}t.prototype=n===null?Object.create(n):(r.prototype=n.prototype,new r)}}();var __assign=this&&this.__assign||function(){__assign=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++){t=arguments[n];for(var i in t)if(Object.prototype.hasOwnProperty.call(t,i))e[i]=t[i]}return e};return __assign.apply(this,arguments)};var __importDefault=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};define("scenes/cyberball",["require","exports","enums/leave-trigger","phaser"],(function(e,t,n,r){"use strict";Object.defineProperty(t,"__esModule",{value:true});t.CyberballScene=void 0;r=__importDefault(r);var i={fontFamily:"Arial",color:"#000000"};var a=function(e){__extends(t,e);function t(t){var n=e.call(this,{})||this;n.cpuSprites=[];n.playerHasBall=true;n.ballHeld=true;n.absentPlayers=[];n.showPlayerLeave=false;n.gameEnded=false;n.throwCount=0;n.scheduleIndex=0;n.lastTime=Date.now();n.startTime=Date.now();n.settings=t;return n}t.prototype.preload=function(){var e=this;this.load.crossOrigin="anonymous";this.load.image("ball","".concat(this.settings.baseUrl,"/").concat(this.settings.ballSprite));this.load.multiatlas("player","".concat(this.settings.baseUrl,"/player.json"),"assets");if(this.settings.player.portrait)this.load.image("playerPortrait","https://cors-anywhere.herokuapp.com/"+this.settings.player.portrait);this.settings.computerPlayers.forEach((function(t,n){if(t.portrait)e.load.image("cpuPortrait"+n,"https://cors-anywhere.herokuapp.com/"+t.portrait)}))};t.prototype.create=function(){var e=this;this.cameras.main.setBackgroundColor("#ffffff");this.anims.create({key:"active",frames:this.anims.generateFrameNames("player",{start:1,end:1,prefix:"active/",suffix:".png"})});this.anims.create({key:"idle",frames:this.anims.generateFrameNames("player",{start:1,end:1,prefix:"idle/",suffix:".png"})});this.anims.create({key:"throw",frameRate:12,frames:this.anims.generateFrameNames("player",{start:1,end:3,prefix:"throw/",suffix:".png"})});this.anims.create({key:"catch",frames:this.anims.generateFrameNames("player",{start:1,end:1,prefix:"catch/",suffix:".png"})});var t=this.getPlayerPosition();this.playerGroup=this.physics.add.group({immovable:true,allowGravity:false});this.playerSprite=this.playerGroup.create(t.x,t.y,"player","active/1.png");this.playerSprite.setData("settings",this.settings.player);if(this.settings.player.tint)this.playerSprite.setTint(parseInt(this.settings.player.tint.substr(1),16));this.playerSprite.setData("name-object",this.add.text(t.x,t.y+this.playerSprite.height/2+10,this.settings.player.name,i).setOrigin(.5));if(this.settings.player.portrait){var r=this.getPlayerPortraitPosition(this.playerSprite);var a=this.add.image(r.x,r.y,"playerPortrait");a.setScale(this.settings.portraitHeight/a.height)}if((this.settings.player.leaveTrigger&n.LeaveTrigger.Time)===n.LeaveTrigger.Time){this.playerSprite.setData("leaveTime",Date.now()+this.getVariantValue(this.settings.player.leaveIgnored,this.settings.player.leaveIgnoredVariance)*1e3)}if((this.settings.player.leaveTrigger&n.LeaveTrigger.TimeIgnored)===n.LeaveTrigger.TimeIgnored){this.playerSprite.setData("leaveTimeIgnored",Date.now()+this.getVariantValue(this.settings.player.leaveTimeIgnored,this.settings.player.leaveTimeIgnoredVariance)*1e3);console.log(Date.now(),this.playerSprite.getData("leaveTimeIgnored")-Date.now())}var s=function(s){var o=l.getCPUPosition(s);var u=l.playerGroup.create(o.x,o.y,"player","idle/1.png");u.setData("name-object",l.add.text(o.x,o.y+u.height/2+10,l.settings.computerPlayers[s].name,i).setOrigin(.5));if(l.settings.computerPlayers[s].portrait){r=l.getCPUPortraitPosition(s,u);a=l.add.image(r.x,r.y,"cpuPortrait"+s);a.setScale(l.settings.portraitHeight/a.height)}u.flipX=o.x>t.x;u.setData("settings",l.settings.computerPlayers[s]);if(l.settings.computerPlayers[s].tint)u.setTint(parseInt(l.settings.computerPlayers[s].tint.substr(1),16));u.setInteractive();u.on("pointerdown",(function(t){if(e.playerHasBall){e.playerSprite.flipX=e.input.x<e.playerSprite.x;var n=e.getActiveBallPosition(e.playerSprite);e.ballSprite.x=n.x;e.ballSprite.y=n.y;e.throwBall(e.playerSprite,u)}}));if((l.settings.computerPlayers[s].leaveTrigger&n.LeaveTrigger.Time)===n.LeaveTrigger.Time){u.setData("leaveTime",Date.now()+l.getVariantValue(l.settings.computerPlayers[s].leaveIgnored,l.settings.computerPlayers[s].leaveIgnoredVariance)*1e3)}if((l.settings.computerPlayers[s].leaveTrigger&n.LeaveTrigger.TimeIgnored)===n.LeaveTrigger.TimeIgnored){u.setData("leaveTimeIgnored",Date.now()+l.getVariantValue(l.settings.computerPlayers[s].leaveTimeIgnored,l.settings.computerPlayers[s].leaveTimeIgnoredVariance)*1e3)}l.cpuSprites.push(u)};var l=this,r,a;for(var o=0;o<this.settings.computerPlayers.length;o++){s(o)}var u=this.getActiveBallPosition(this.playerSprite);this.ballSprite=this.physics.add.sprite(u.x,u.y,"ball");if(this.settings.ballTint)this.ballSprite.setTint(parseInt(this.settings.ballTint.substr(1),16));this.physics.add.overlap(this.ballSprite,this.playerGroup,(function(t,n){if(!e.ballHeld&&n===e.throwTarget)e.catchBall(n)}))};t.prototype.update=function(){var e=this;if(this.playerHasBall){this.playerSprite.play("active");this.playerSprite.flipX=this.input.x<this.playerSprite.x;var t=this.getActiveBallPosition(this.playerSprite);this.ballSprite.x=t.x;this.ballSprite.y=t.y}else if(!this.ballHeld){this.playerGroup.getChildren().forEach((function(t){var n=t;if(n.frame.name.includes("idle"))n.flipX=e.ballSprite.x<n.x}))}if(!this.showPlayerLeave&&(this.settings.player.leaveTrigger&n.LeaveTrigger.Time)===n.LeaveTrigger.Time&&Date.now()>this.playerSprite.getData("leaveTime")){this.showPlayerLeave=true;this.postEvent("player-may-leave",{reason:"time elapsed"})}else if(!this.playerHasBall&&!this.showPlayerLeave&&(this.settings.player.leaveTrigger&n.LeaveTrigger.TimeIgnored)===n.LeaveTrigger.TimeIgnored&&Date.now()>this.playerSprite.getData("leaveTimeIgnored")){this.showPlayerLeave=true;this.postEvent("player-may-leave",{reason:"time ignored"})}this.cpuSprites.forEach((function(t){if(t==e.throwTarget||t.getData("absent"))return;var r=t.getData("settings");if((r.leaveTrigger&n.LeaveTrigger.Time)===n.LeaveTrigger.Time&&Date.now()>t.getData("leaveTime")){e.leaveGame(t,"time elapsed")}else if((r.leaveTrigger&n.LeaveTrigger.TimeIgnored)===n.LeaveTrigger.TimeIgnored&&Date.now()>t.getData("leaveTimeIgnored")){e.leaveGame(t,"time ignored")}}))};t.prototype.gameOver=function(){if(this.gameEnded)return;this.gameEnded=true;this.postEvent("game-end");clearTimeout(this.activeTimeout);this.playerGroup.children.each((function(e){return e.removeAllListeners()}));this.add.rectangle(this.sys.canvas.width/2,this.sys.canvas.height/2,this.sys.canvas.width,this.sys.canvas.height,14540253,.5);this.add.text(this.sys.canvas.width/2,this.sys.canvas.height/2,this.settings.gameOverText,i).setOrigin(.5)};t.prototype.throwBall=function(e,t){this.postEvent("throw",{thrower:e.getData("settings").name,receiver:t.getData("settings").name,wait:Date.now()-this.lastTime});this.lastTime=Date.now();var r=e.getData("settings");if((r.leaveTrigger&n.LeaveTrigger.TimeIgnored)===n.LeaveTrigger.TimeIgnored){t.setData("leaveTimeIgnored",Date.now()+this.getVariantValue(r.leaveTimeIgnored,r.leaveTimeIgnoredVariance)*1e3)}this.playerHasBall=this.ballHeld=false;this.throwTarget=t;this.throwCount++;e.play("throw");e.playAfterRepeat("idle");var i=this.getCaughtBallPosition(t);this.physics.moveTo(this.ballSprite,i.x,i.y,this.settings.ballSpeed)};t.prototype.catchBall=function(e){var t=this;var r;this.ballHeld=true;e.setData("throwsIgnored",0);e.play("catch");var i=this.getCaughtBallPosition(e);this.ballSprite.body.reset(i.x,i.y);if(!this.showPlayerLeave&&(this.settings.player.leaveTrigger&n.LeaveTrigger.Turn)===n.LeaveTrigger.Turn){var a=this.getVariantValue(this.settings.player.leaveTurn,this.settings.player.leaveTurnVariance);if(this.throwCount>=a){this.showPlayerLeave=true;this.postEvent("player-may-leave",{reason:"throws elapsed"})}}else if(!this.showPlayerLeave&&(this.settings.player.leaveTrigger&n.LeaveTrigger.Ignored)===n.LeaveTrigger.Ignored){var a=this.getVariantValue(this.settings.player.leaveIgnored,this.settings.player.leaveIgnoredVariance);var s=(r=this.playerSprite.getData("throwsIgnored"))!==null&&r!==void 0?r:0;if(this.playerSprite!=e)this.playerSprite.setData("throwsIgnored",++s);if(s>=a){this.showPlayerLeave=true;this.postEvent("player-may-leave",{reason:"throws ignored"})}}this.cpuSprites.forEach((function(r){var i;if(r==e||r.getData("absent"))return;var a=r.getData("settings");var s=((i=r.getData("throwsIgnored"))!==null&&i!==void 0?i:0)+1;r.setData("throwsIgnored",s);if((a.leaveTrigger&n.LeaveTrigger.Turn)===n.LeaveTrigger.Turn){var l=t.getVariantValue(a.leaveTurn,a.leaveTurnVariance);if(t.throwCount>=l&&t.checkChance(a.leaveTurnChance))t.leaveGame(r,"throws elapsed")}else if((a.leaveTrigger&n.LeaveTrigger.Ignored)===n.LeaveTrigger.Ignored){var l=t.getVariantValue(a.leaveIgnored,a.leaveIgnoredVariance);if(s>=l&&t.checkChance(a.leaveIgnoredChance))t.leaveGame(r,"throws ignored")}}));if(this.settings.useSchedule&&this.scheduleIndex===this.settings.schedule.length||this.settings.useSchedule&&this.settings.scheduleHonorsThrowCount&&this.throwCount>=this.settings.throwCount||!this.settings.useSchedule&&this.throwCount>=this.settings.throwCount){this.gameOver();return}if(e===this.playerSprite){this.playerHasBall=true}else{var l=e.getData("settings");this.activeTimeout=setTimeout((function(){e.play("active");i=t.getActiveBallPosition(e);t.ballSprite.x=i.x;t.ballSprite.y=i.y;t.activeTimeout=setTimeout((function(){if(t.settings.useSchedule){while(t.settings.schedule[t.scheduleIndex]===t.playerGroup.getChildren().indexOf(e)&&!t.absentPlayers.includes(t.settings.schedule[t.scheduleIndex]))t.scheduleIndex++;t.throwBall(e,t.playerGroup.getChildren()[t.settings.schedule[t.scheduleIndex]]);t.scheduleIndex++}else{var n=Math.random()*100;for(var r=0;r<l.targetPreference.length;r++){n-=l.targetPreference[r];if(n<=0){if(r>=t.playerGroup.getChildren().indexOf(e))r++;t.throwBall(e,t.playerGroup.getChildren()[r]);break}}}}),t.getVariantValue(l.throwDelay,l.throwDelayVariance))}),this.getVariantValue(l.catchDelay,l.catchDelayVariance))}};t.prototype.leaveGame=function(e,t){var r=this;if(t===void 0){t=""}var i=e.getData("name-object");var a=this.playerGroup.getChildren().indexOf(e);this.absentPlayers.push(a);e.setData("absent",true);i.setText([i.text,"has left the game."]);e.removeAllListeners();e.setVisible(false);this.postEvent("leave",{leaver:e.getData("settings").name,reason:t});console.log("pindex",a);this.settings.computerPlayers.forEach((function(e,t){if(r.absentPlayers.includes(t+1))return;console.log("distribute before",t,e.targetPreference);var n=a>t+1?a-1:a;var i=e.targetPreference[n];e.targetPreference[n]=0;var s=e.targetPreference.reduce((function(e,t){return e+t}));for(var l=0;l<e.targetPreference.length;l++){if(e.targetPreference[l]==0)continue;e.targetPreference[l]+=e.targetPreference[l]/s*i}console.log("distribute after",t,e.targetPreference)}));if(this.absentPlayers.length>=this.settings.computerPlayers.length){this.gameOver();return}if(!this.showPlayerLeave&&(this.settings.player.leaveTrigger&n.LeaveTrigger.OtherLeaver)===n.LeaveTrigger.OtherLeaver){console.log(this.absentPlayers.length,this.settings.player.leaveOtherLeaver);if(this.absentPlayers.length>=this.settings.player.leaveOtherLeaver){this.showPlayerLeave=true;this.postEvent("player-may-leave",{reason:"other leavers"})}}this.cpuSprites.forEach((function(e){var t=e.getData("settings");if(e==r.throwTarget||e.getData("absent"))return;if((t.leaveTrigger&n.LeaveTrigger.OtherLeaver)===n.LeaveTrigger.OtherLeaver){if(r.absentPlayers.length>=t.leaveOtherLeaver&&r.checkChance(t.leaveOtherLeaverChance))r.leaveGame(e,"other leavers")}}))};t.prototype.getCPUPosition=function(e){var t=75;var n=this.settings.hasPortraits?this.settings.portraitHeight+this.settings.portraitPadding*2:0;if(this.settings.computerPlayers.length===1){return new r.default.Geom.Point(this.sys.canvas.width/2,t+n)}return new r.default.Geom.Point((this.sys.canvas.width-t*2)/(this.settings.computerPlayers.length-1)*e+t,e===0||e===this.settings.computerPlayers.length-1?this.sys.canvas.height/2:t+n)};t.prototype.getCPUPortraitPosition=function(e,t){var n=this.getCPUPosition(e);return new r.default.Geom.Point(n.x,n.y-this.settings.portraitHeight+this.settings.portraitPadding*2-t.height/2)};t.prototype.getPlayerPosition=function(){var e=75;if(this.settings.hasPortraits)e+=this.settings.portraitHeight+this.settings.portraitPadding*2;return new r.default.Geom.Point(this.sys.canvas.width/2,this.sys.canvas.height-e)};t.prototype.getPlayerPortraitPosition=function(e){var t=this.getPlayerPosition();return new r.default.Geom.Point(t.x,t.y+this.settings.portraitHeight/2+this.settings.portraitPadding*2+e.height/2+10)};t.prototype.getCaughtBallPosition=function(e){return new r.default.Geom.Point(e.x+(e.flipX?-50:50),e.y-15)};t.prototype.getActiveBallPosition=function(e){return new r.default.Geom.Point(e.x+(e.flipX?40:-40),e.y-20)};t.prototype.getVariantValue=function(e,t){return e+r.default.Math.RND.between(0,t)*r.default.Math.RND.sign()};t.prototype.checkChance=function(e){return r.default.Math.RND.between(0,100)<=e};t.prototype.postEvent=function(e,t){if(t===void 0){t={}}console.log("post event: "+e,t);window.parent.postMessage(__assign({type:e},t),"*")};return t}(r.default.Scene);t.CyberballScene=a}));define("resources",["resources/index"],(function(e){return e}));